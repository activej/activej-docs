(self.webpackChunkactivejdocs=self.webpackChunkactivejdocs||[]).push([[9869],{14304:function(e,n,a){"use strict";var t=a(67294),i=a(21140),r=a.n(i);r().initialize({startOnLoad:!0});n.Z=function(e){var n=e.chart;return(0,t.useEffect)((function(){r().contentLoaded()}),[]),t.createElement("div",{className:"mermaid"},n)}},26802:function(e,n,a){"use strict";a.r(n),a.d(n,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var t=a(83117),i=a(80102),r=(a(67294),a(3905)),l=a(14304),o=["components"],s={sidebar_label:"\u5b9e\u4f8b"},c="\u5b9e\u4f8b",p={unversionedId:"specializer/examples",id:"specializer/examples",isDocsHomePage:!1,title:"\u5b9e\u4f8b",description:"\u8bf7\u8bb0\u4f4f\uff0cActiveJ Specializer\u662f\u4e00\u4e2a\u5b9e\u9a8c\u6027\u9879\u76ee\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u5b83\u3002 \u5b83\u4e0d\u652f\u6301lambda\u8868\u8fbe\u5f0f\uff0c\u800c\u4e14\u5728\u4e13\u95e8\u5904\u7406\u975e\u7410\u788e\u7684\u5b9e\u4f8b\u65f6\u53ef\u80fd\u4f1a\u6709\u56f0\u96be\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/specializer/examples.mdx",sourceDirName:"specializer",slug:"/specializer/examples",permalink:"/zh/specializer/examples",tags:[],version:"current",frontMatter:{sidebar_label:"\u5b9e\u4f8b"},sidebar:"docs",previous:{title:"\u6982\u8ff0",permalink:"/zh/specializer"},next:{title:"\u6982\u8ff0",permalink:"/zh/rpc"}},u=[{value:"\u7b80\u5355\u7684\u8ba1\u7b97\u5668",id:"\u7b80\u5355\u7684\u8ba1\u7b97\u5668",children:[],level:2}],m={toc:u};function d(e){var n=e.components,a=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,t.Z)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u5b9e\u4f8b"},"\u5b9e\u4f8b"),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u8bf7\u8bb0\u4f4f\uff0cActiveJ Specializer\u662f\u4e00\u4e2a\u5b9e\u9a8c\u6027\u9879\u76ee\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u5b83\u3002 \u5b83\u4e0d\u652f\u6301lambda\u8868\u8fbe\u5f0f\uff0c\u800c\u4e14\u5728\u4e13\u95e8\u5904\u7406\u975e\u7410\u788e\u7684\u5b9e\u4f8b\u65f6\u53ef\u80fd\u4f1a\u6709\u56f0\u96be\u3002"))),(0,r.kt)("h2",{id:"\u7b80\u5355\u7684\u8ba1\u7b97\u5668"},"\u7b80\u5355\u7684\u8ba1\u7b97\u5668"),(0,r.kt)("p",null,"\u6211\u4eec\u628a\u8fd9\u4e2a ",(0,r.kt)("a",{href:"https://github.com/jparsec/jparsec/wiki/Tutorial"},"Parsec\u8ba1\u7b97\u5668\u7684\u6559\u7a0b")," \uff0c\u5e76\u4e3aActiveJ Specializer\u505a\u4e86\u4e00\u4e9b\u8c03\u6574\u3002 \u5728\u6700\u521d\u7684\u6559\u7a0b\u4e2d\uff0cParsec\u5c06\u89e3\u6790\u7684\u8868\u8fbe\u5f0f\u8fd4\u56de\u4e3a\u53cc\u500d\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'\u89e3\u6790\u5668<Double> parser = new OperatorTable<Double>()\n    .infixl(op(" ", (l, r) -> l r), 10)\n    .infixl(op("-", (l, r) -> l - r), 10)\n    .infixl(Parsers.or(term("*"), WHITESPACE_MUL).retn((l, r) -> l * r), 20)\n    .infixl(op("/", (l, r) -> l / r), 20)\n    .prefix(op("-", v -> -v), 30)\n    .building(unit) \u3002\n')),(0,r.kt)("p",null,"ActiveJ Specializer\u5728\u6811\u72b6\u6570\u636e\u7ed3\u6784\u65b9\u9762\u663e\u793a\u4e86\u5b83\u7684\u4f18\u52bf\u3002 \u6240\u4ee5\u6211\u4eec\u5c06\u628a\u8868\u8fbe\u5f0f\u89e3\u6790\u4e3aAST\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private static final Parser<CalculatorExpression> EXPRESSION = new OperatorTable<CalculatorExpression>()\n        .infixl(DELIMITERS.token("+").retn(Sum::new), 10)\n        .infixl(DELIMITERS.token("-").retn(Sub::new), 10)\n        .infixl(DELIMITERS.token("*").retn(Mul::new), 20)\n        .infixl(DELIMITERS.token("/").retn(Div::new), 20)\n        .infixl(DELIMITERS.token("%").retn(Mod::new), 20)\n        .prefix(DELIMITERS.token("-").retn(Neg::new), 30)\n        .infixr(DELIMITERS.token("^").retn(Pow::new), 40)\n        .build(ATOM);\n')),(0,r.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u7a0b\u5f0f ",(0,r.kt)("inlineCode",{parentName:"p"},"3 2 * 4"),"\u3002 \u6839\u636e\u89e3\u6790\u5668\uff0c\u5c06\u521b\u5efa\u4ee5\u4e0bAST\u3002"),(0,r.kt)(l.Z,{chart:"\ngraph TD\n+ --\x3e 3\n+ --\x3e *\n* --\x3e 2\n* --\x3e 4\n",mdxType:"Mermaid"}),(0,r.kt)("p",null,"\u8ba9\u6211\u4eec\u6d4b\u8bd5\u4e00\u4e0bSpecializer\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:"url=/examples/core/specializer/src/main/java/calculator/SpecializerCalculatorExample.java tag=REGION_2",url:"/examples/core/specializer/src/main/java/calculator/SpecializerCalculatorExample.java",tag:"REGION_2"},'public static void main(String[] args) {\n  double x = -1;\n\n  // manual code, superfast\n  System.out.println(((2.0 + 2.0 * 2.0) * -x) + 5.0 + 1024.0 / (100.0 + 58.0) * 50.0 * 37.0 - 100.0 + 2.0 * (Math.pow(x, 2.0)) % 3.0);\n\n  CalculatorExpression expression = PARSER.parse("((2 + 2 * 2) * -x) + 5 + 1024 / (100 + 58) * 50 * 37 - 100 + 2 * x ^ 2 % 3");\n\n  System.out.println(expression);\n\n  // tree-walking evaluation, super slow\n  System.out.println(expression.evaluate(x));\n\n  // specialized instance evaluation, about as fast as manual code\n  CalculatorExpression specialized = SPECIALIZER.specialize(expression);\n  System.out.println(specialized.evaluate(x));\n}\n')),(0,r.kt)("p",null,"ActiveJ Specializer\u5c06AST\u8f6c\u5316\u4e3a\u4e00\u7ec4\u9759\u6001\u7684\u6700\u7ec8\u7c7b\uff0c\u5e76\u5c06\u6240\u63d0\u4f9b\u7684 \u65b9\u7a0b\u7684\u503c\u70d8\u70e4\u51fa\u6765\u3002 JIT\u5728\u8fd0\u884c\u65f6\u5bf9\u8fd9\u4e9b\u7c7b\u8fdb\u884c\u4e86\u5927\u91cf\u7684\u4f18\u5316\u548c\u5185\u8054\u3002 \u56e0\u6b64\uff0c\u6211\u4eec\u6536\u5230\u4e86\u4e00\u4e2a\u4f18\u5316\u7684\u8868\u8fbe\u5f0f \u5b9e\u4f8b\uff0c\u5728\u6211\u4eec\u591a\u6b21\u8ba1\u7b97\u4e00\u4e2a\u672a\u77e5\u503c\u7684\u65b9\u7a0b\u65f6\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u3002\n\u662f\u65f6\u5019\u8fdb\u884c\u4e00\u4e9b\u57fa\u51c6\u6d4b\u8bd5\u4e86\u3002 \u8ba9\u6211\u4eec\u5c1d\u8bd5\u4ee5\u4e09\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u5904\u7406\u65b9\u7a0b ",(0,r.kt)("inlineCode",{parentName:"p"},"(2+ 2 * 2) * -x) + 5 + 1024 / (100 + 58) * 50 * 37 - 100 + 2 * x ^2 % 3")," \u5e76\u6bd4\u8f83\u6027\u80fd\uff1a ",(0,r.kt)("em",{parentName:"p"}," \u624b\u52a8\u8f93\u5165\u65b9\u7a0b ")," \u89e3\u6790\u65b9\u7a0b\u5e76\u8bc4\u4f30\u5b83 ",(0,r.kt)("strong",{parentName:"p"},"\u65e0\u4e13\u4e1a\u5316")," * \u89e3\u6790\u65b9\u7a0b\u5e76\u8bc4\u4ef7\u5b83 ",(0,r.kt)("strong",{parentName:"p"},"\u4e13\u4e1a\u5316"),"\n\u57fa\u51c6\u7684\u7ed3\u679c\u5f88\u80fd\u8bf4\u660e\u95ee\u9898\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\u57fa\u51c6\u6a21\u5f0f Cnt\u5f97\u5206 \u8bef\u5dee\u5355\u4f4d\nCalculatorBenchmark.ast avgt 10 828.924 \xb1 8.369 ns/op\nCalculatorBenchmark.manual avgt 10 115.985 \xb1 1.009 ns/op\nCalculatorBenchmark.specialized avgt 10 117.635 \xb1 1.500 ns/op\n")),(0,r.kt)("p",null,"\u6b63\u5982\u4f60\u6240\u770b\u5230\u7684\uff0c\u624b\u52a8\u8f93\u5165\u7684\u65b9\u7a0b\u5f0f\u548c\u4e13\u95e8\u7684AST\u7684\u5904\u7406\u901f\u5ea6\u662f\u4e00\u6837\u7684\u3002 ActiveJ Specializer\u5c06 \uff0c\u5c06AST\u7684\u5904\u7406\u901f\u5ea6\u63d0\u9ad8\u4e868\u500d\u3002"))}d.isMDXComponent=!0},11748:function(e,n,a){var t={"./locale":89234,"./locale.js":89234};function i(e){var n=r(e);return a(n)}function r(e){if(!a.o(t,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t[e]}i.keys=function(){return Object.keys(t)},i.resolve=r,e.exports=i,i.id=11748}}]);