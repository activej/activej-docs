<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="ActiveJ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="ActiveJ Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">ActiveJ串行器｜世界上最快的JVM串行器 | ActiveJ</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/zh/serializer/examples"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ串行器｜世界上最快的JVM串行器 | ActiveJ"><meta data-react-helmet="true" name="description" content="ActiveJ串行器是世界上最快的JVM串行器。 它是精简的，具有强大的工具和直观的DSL。"><meta data-react-helmet="true" property="og:description" content="ActiveJ串行器是世界上最快的JVM串行器。 它是精简的，具有强大的工具和直观的DSL。"><meta data-react-helmet="true" name="keywords" content="序列化器,java,JAVA框架,初学者的Java,对象序列化,spring 替代方案,比特码生成器"><link data-react-helmet="true" rel="shortcut icon" href="/zh/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/zh/serializer/examples"><link data-react-helmet="true" rel="alternate" href="https://activej.io/serializer/examples" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/serializer/examples" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/serializer/examples" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/serializer/examples" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.cd595f84.css">
<link rel="preload" href="/zh/assets/js/runtime~main.0ddb9244.js" as="script">
<link rel="preload" href="/zh/assets/js/main.e382525e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh/overview">文件</a><a class="navbar__item navbar__link" href="/zh/tutorials/getting-started">教程</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文 (machine translation)</span></span></a><ul class="dropdown__menu"><li><a href="/serializer/examples" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/serializer/examples" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文 (machine translation)</a></li><li><a href="/ru/serializer/examples" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Русский (machine translation)</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/blog">博客</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/zh/overview">概述</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">异步I/O</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">靴子</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">注入</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">编码基因</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">串行器</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/serializer">概述</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/serializer/examples">实例</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">专业人员</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">雇员</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">杂项</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">在这一页</button></div><div class="theme-doc-markdown markdown"><header><h1>实例</h1></header><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>要运行例子，你需要从GitHub克隆ActiveJ</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W shell"><pre tabindex="0" class="prism-code language-shell codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/activej/activej</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>并将其作为一个Maven项目导入。 查看标签 <strong>v5.0-beta2</strong>。 在运行这些例子之前，先建立项目。 这些例子位于 <code>activej/examples/core/serializer。</code></p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="简单的对象序列化"></a>简单的对象序列化<a class="hash-link" href="#简单的对象序列化" title="直接链接到标题">#</a></h2><p>为了创建其实例可以被序列化/反序列化的类，你应该使用特殊的注解。</p><ul><li><a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations/Serialize.java" target="_blank">@Serialize</a> 在属性获取器上添加订单号的注释。 参数 `顺序` 在类被改变的情况下提供更好的兼容性。</li><li><a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations/Deserialize.java" target="_blank">@Deserialize</a> 注解，在构造函数中使用属性名称（应该与getter中的名称相同）。</li></ul><p>这足以创建可序列化的POJO，例如。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Person {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Person(@Deserialize(&quot;age&quot;) int age,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Deserialize(&quot;name&quot;) String name) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.age = age;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.name = name;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final int age;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final String name;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  private String surname;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String getSurname() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return surname;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void setSurname(String surname) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.surname = surname;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>现在，让我们做一些序列化工作。 我们将创建一个 <code>Person</code> 实例，一个存储序列化结果的字节数组，以及一个 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/BinarySerializer.java" target="_blank">BinarySerializer</a> 实例，代表一个将 <code>&lt;T&gt;</code> 值编码和解码为字节数组的序列化器（本例中是<code>&lt;Person&gt;</code> 值）。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Person john = new Person(34, &quot;Jim&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">john.setSurname(&quot;Smith&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">byte[] buffer = new byte[200];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;Person&gt; serializer = SerializerBuilder.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build(Person.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>就这样，现在我们可以序列化和反序列化我们的 <code>Person</code> 实例。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">serializer.encode(buffer, 0, john);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Person johnCopy = serializer.decode(buffer, 0);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>让我们做一个简单的测试来检查一切是否正常工作。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.age + &quot; &quot; + johnCopy.age);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.name + &quot; &quot; + johnCopy.name);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.getSurname() + &quot; &quot; + johnCopy.getSurname());</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>在你运行这个例子后，你会收到以下输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">34</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">34</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Jim Jim</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Smith Smith</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>这意味着序列化和反序列化工作正常。</p><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/SimpleObjectExample.java" target="_blank">GitHub</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="泛型和接口"></a>泛型和接口<a class="hash-link" href="#泛型和接口" title="直接链接到标题">#</a></h2><p>ActiveJ串行器可以简单地管理更复杂的对象。 例如，让我们看看它是如何与接口和 泛型的工作。</p><p>首先，创建一个简单的 <code>技能</code> 类。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.age + &quot; &quot; + johnCopy.age);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.name + &quot; &quot; + johnCopy.name);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(john.getSurname() + &quot; &quot; + johnCopy.getSurname());</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>接下来，创建一个 <code>Person</code> 接口，它有一个返回技能列表的方法。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public interface Person&lt;K, V&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  List&lt;Skill&lt;K, V&gt;&gt; getSkills();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>最后创建一个 <code>Developer</code> 类，实现 <code>Person</code> 接口。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Developer implements Person&lt;Integer, String&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  private List&lt;Skill&lt;Integer, String&gt;&gt; list;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;Skill&lt;Integer, String&gt;&gt; getSkills() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return list;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void setSkills(List&lt;Skill&lt;Integer, String&gt;&gt; list) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.list = list;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>让我们继续进行序列化。 与前面的例子类似，我们将创建一个 <code>Developer</code>的实例，一个 字节数组来存储序列化的结果，以及一个 <code>BinarySerializer&lt;Developer&gt;</code> serializer 的实例。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Developer developer = new Developer();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">developer.setSkills(Arrays.asList(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    new Skill&lt;&gt;(1, &quot;Java&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    new Skill&lt;&gt;(2, &quot;ActiveJ&quot;)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">byte[] buffer = new byte[200];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;Developer&gt; serializer = SerializerBuilder.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build(Developer.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>现在让我们对我们的 <code>Developer</code> 实例进行序列化和反序列化。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">serializer.encode(buffer, 0, developer);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Developer developer2 = serializer.decode(buffer, 0);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>检查序列化的工作是否正确。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">for (int i = 0; i &lt; developer.getSkills().size(); i++) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  System.out.println(developer.getSkills().get(i).getKey() + &quot; - &quot; + developer.getSkills().get(i).getValue() +</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;, &quot; + developer2.getSkills().get(i).getKey() + &quot; - &quot; + developer2.getSkills().get(i).getValue());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>如果你运行这个例子，你会收到以下输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain"> - Java, </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> - Java</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> - ActiveJ, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> - ActiveJ</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>这意味着序列化工作是正确的。</p><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/GenericsAndInterfacesExample.java" target="_blank">GitHub</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="基于路径的序列化"></a>基于路径的序列化<a class="hash-link" href="#基于路径的序列化" title="直接链接到标题">#</a></h2><p>有时你需要序列化一个代表通用类型的字段。 比方说，一个 <code>地图</code>。 你需要做的就是在该字段上放一个 <code>@Serialize</code> 注释。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public Map&lt;Integer, String&gt;&gt; map;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>但是，如果你想让一个地图包含可归零的值怎么办？ 你可以使用 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations/SerializeNullable.java" target="_blank">@SerializeNullable</a> 注释。 然而，如果你只是把这个注释放在一个字段上，那就意味着整个地图都可以是空的。</p><p>我们应该把注释直接放在一个 <code>String</code>! 从ActiveJ v5.0-beta1开始，一些序列化注解适用于一个类型的使用。 因此，每当你需要用额外的序列化信息来标记一些类型时，只要把注解放在一个类型上即可。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public Map&lt;Integer, @SerializeNullable String&gt;&gt; map;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>在旧版本的ActiveJ中，指定哪种类型应该是nullable的唯一方法，例如，通过使用注解中的 <code>path</code> 选项。 要序列化一个具有可忽略值的地图，你需要做这样的事情。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = 1)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public Map&lt;Integer, String&gt;&gt; map;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>每个类型参数都有自己的索引，从0开始。 因此， <code>整数</code> 的索引为0， <code>字符串</code> 的索引为1。 为了指定String可以为空，我们在注解中添加 <code>path = 1</code>。</p><p><code>路径</code> 参数实际上是一个ints数组，所以你可以在嵌套声明中指定一个nullable类型。 你也可以在一个字段（或获取器）上放置多个基于路径的注释。</p><p>下面是一个例子。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable //指地图&lt;String, Map&lt;Integer, Float[]&gt;&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = 1) //指地图&lt;Integer, Float[]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = 0) // refers to String</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = {1, 0}) // refers to Integer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = {1, 1}) // refers to Float[]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@SerializeNullable(path = {1, 1, 0}) //refers to the Float elements of the array</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public Map&lt;String, Map&lt;Integer, Float[]&gt;&gt; complexMap;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>不幸的是，在某些情况下，如果一个类型被注解了，旧版本的Java可能无法正确解决注解所注解的类型参数。 在这种情况下，如果你使用小于12的Java版本运行你的应用程序，你可以使用基于路径的方法。</p></div></div><p>在本教程中，我们将向你展示如何使用路径方法或类型使用方法来编写序列化器。</p><p>首先，让我们来看看一个类型的使用方法。</p><p>我们将定义一个参数化的类 <code>嵌套</code>。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Nested&lt;T1, T2&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final T1 first;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final T2 second;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Nested(@Deserialize(&quot;first&quot;) T1 first, @Deserialize(&quot;second&quot;) T2 second) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.first = first;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.second = second;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String toString() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;Nested{&quot; + first + &quot;, &quot; + second + &#x27;}&#x27;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>然后我们定义一个 <code>Storage</code> 类来进行序列化。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Storage {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;@SerializeNullable Nested&lt;Integer, @SerializeNullable String&gt;&gt; listOfNested;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>一个类有一个单一的字段，它作为一个 <code>列表</code> ，可归零 <code>嵌套</code>。 此外， <code>嵌套</code> 类的第二个类型参数(<code>String</code>)本身是可以归零的。
我们创建一个序列化器，如下所示。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;Storage&gt; serializer = SerializerBuilder.create(definingClassLoader)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build(Storage.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>然后我们构建一个 <code>Storage</code> 类，并在列表中添加可忽略的元素。 一旦我们运行这个例子，我们应该看到以下输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W"><pre tabindex="0" class="prism-code language-undefined codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">[嵌套{1, abc}, null, 嵌套{5, null}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[嵌套{1, abc}, null, 嵌套{5, null}]</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>这既显示了原始的 <code>Storage</code> 内容，也显示了反序列化的内容。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>在对数组进行注释时，应特别注意。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Foo String @Bar []</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>这里， <code>@Foo</code> 注解了 <code>String</code> ，而 <code>@Bar</code> 注解了整个数组 <code>String[]</code>。</p><p>这符合 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-9.html#jls-9.7.4" target="_blank" rel="noopener noreferrer">《Java语言规范》的规定。</a></p></div></div><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/SerializeNoPathExample.java" target="_blank">GitHub</a></p><p>现在，让我们看看基于路径的方法。</p><p>我们将使用相同的 <code>嵌套</code> 类。 然而，我们将使用带有 <code>路径</code>的注解来注解 <code>存储</code> 类的一个字段。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Storage {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @SerializeNullable(path = 0)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @SerializeNullable(path = {0, 1})</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;Nested&lt;Integer, String&gt;&gt; listOfNested;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p><strong>当创建一个序列化器时，应该启用注解兼容模式。</strong></p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;Storage&gt; serializer = SerializerBuilder.create(definingClassLoader)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .withAnnotationCompatibilityMode() // Compatibility mode has to be enabled</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build(Storage.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>运行 <code>main</code> 方法后，我们应该看到与类型使用方法相同的输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">嵌套</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, abc</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, null, 嵌套</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">, null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">嵌套</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, abc</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, null, 嵌套</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">, null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/SerializePathExample.java" target="_blank">GitHub</a></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>你不能混合两种注释方式。 如果你想使用类型使用方法，那么就按原样使用。 只要确保你的Java版本可以解决类型上的注解。</p><p>对于基于路径的方法，不要忘记在 <code>SerializerBuilder上启用注释兼容模式</code>。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="固定大小和可置换字段的序列化"></a>固定大小和可置换字段的序列化<a class="hash-link" href="#固定大小和可置换字段的序列化" title="直接链接到标题">#</a></h2><p>ActiveJ串行器有一些 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations" target="_blank">helper annotations</a>，例如。</p><ul><li><a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations/SerializeNullable.java" target="_blank">@SerializeNullable</a> 在可以有空值的属性上。 这个注释也有一个特殊的 `路径` 参数。 它代表了变量的数据类型树的路径。 它允许指出哪些 &quot;节点 &quot;是可忽略的。</li></ul><p>正如你所看到的，你可以为同一个数据结构的不同路径写几个注释。</p><ul><li><a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/annotations/SerializeFixedSize.java" target="_blank">@SerializeFixedSize</a> 在序列化后应该有一个固定大小的属性上</li></ul><p>让我们创建一个简单的例子，说明如何使用这些注释。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class Storage {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public @SerializeNullable String @SerializeFixedSize(3) [] strings;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public byte @SerializeFixedSize(4) [] bytes;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>现在让我们对 <code>Storage</code> 的一个实例进行序列化和反序列化，与前面的例子类似。 我们将创建一个 <code>Storage</code>的实例，一个字节数组来存储序列化的结果，以及一个 <code>BinarySerializer&lt;Storage&gt;</code> serializer 的实例。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Storage storage = new Storage();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">storage.strings = new String[]{&quot;abc&quot;, null, &quot;123&quot;, &quot;superfluous&quot;};</span></span><span class="token-line" style="color:#393A34"><span class="token plain">storage.bytes = new byte[]{1, 2, 3, 4, 5, 6};</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">byte[] buffer = new byte[200];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;Storage&gt; serializer = SerializerBuilder.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build(Storage.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>最后，对 <strong>Storage</strong> 实例进行序列化和反序列化。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">serializer.encode(buffer, 0, storage);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Storage limitedStorage = serializer.decode(buffer, 0);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>让我们看看序列化是如何影响 <em>存储</em>。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(Arrays.toString(storage.strings) + &quot; -&gt; &quot; + Arrays.toString(limitedStorage.strings));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(Arrays.toString(storage.bytes) + &quot; -&gt; &quot; + Arrays.toString(limitedStorage.bytes));</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>如果你运行这个例子，你会看到以下输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">abc, null, </span><span class="token number" style="color:#36acaa">123</span><span class="token plain">, superfluous</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">abc, null, </span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>正如你在第一行看到的， <em>存储</em> 与 <em>limitedStorage</em>不同。 这是因为 <code>@SerializeFixedSize</code> 注解被设置为值 <strong>3</strong> ，用于 <em>strings</em> 属性。 因此，在进行序列化的同时，&quot;多余的 &quot;被从数组中移除。</p><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/FixedSizeFieldsExample.java" target="_blank">GitHub</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="自定义序列化器"></a>自定义序列化器<a class="hash-link" href="#自定义序列化器" title="直接链接到标题">#</a></h2><p>在这个例子中，我们将演示如何为一个 <code>LocalDate</code> 类写一个自定义的序列化器。 你可以把这个例子 作为参考，为你可能需要序列化的其他类编写序列化程序。</p><p>让我们设想一下，我们需要序列化一个包含 <code>LocalDate</code> 字段的类。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class LocalDateHolder {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final LocalDate date;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public LocalDateHolder(@Deserialize(&quot;date&quot;) LocalDate date) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.date = date;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String toString() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;LocalDateHolder{date=&quot; + date + &#x27;}&#x27;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>默认情况下，ActiveJ Serializer不知道如何序列化一个 <code>LocalDate</code> 类，所以如果你 天真地试图序列化它，它会抛出一个异常。 我们必须为一个 <code>LocalDate</code> 类提供一个自定义的序列化器，来序列化 <code>LocalDateHolder</code> 类。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static class SerializerDefLocalDate extends AbstractSerializerDef {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Class&lt;?&gt; getEncodeType() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return LocalDate.class;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Expression encoder(final StaticEncoders staticEncoders,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final Expression buf,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final Variable pos,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final Expression localDate,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final int version,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final CompatibilityLevel compatibilityLevel) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return sequence(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        writeVarInt(buf, pos, call(localDate, &quot;getYear&quot;)),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        writeVarInt(buf, pos, call(localDate, &quot;getMonthValue&quot;)),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        writeVarInt(buf, pos, call(localDate, &quot;getDayOfMonth&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Expression decoder(final StaticDecoders staticDecoders,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final Expression input,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final int version,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      final CompatibilityLevel compatibilityLevel) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return staticCall(LocalDate.class, &quot;of&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        readVarInt(input),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        readVarInt(input),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        readVarInt(input)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>我们扩展 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/AbstractSerializerDef.java" target="_blank">AbstractSerializerDef</a> 类并实现方法： - <code>类&lt;？&gt; getEncodeType()</code> - 指定 <code>本地日期。 lass</code> 为要序列化的数据类型 - <code>表达式编码器(...</code> - 这里我们指示序列化器如何序列化 <code>本地日期</code> 实例。 我们实际上需要 序列化3个 <code>int</code> 值(<code>year</code>, <code>month</code>, and <code>dayOfMonth</code>) 并把它们写到 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/BinaryOutput.java" target="_blank">BinaryOutput</a> 使用类似Lisp的 <code>Expression</code> API，我们就这样做。 - <code>Expression decoder(...)</code> - 这里我们需要指示序列化器如何将原始字节反序列化为一个 <code>LocalDate</code> 实例。 这个过程是与编码相反的。 首先，我们必须阅读3 <code>int</code> values (<code>year</code>, <code>months</code>和 <code>dayOfmonth</code>来自 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/BinaryInput.java" target="_blank">BinaryInput</a> 然后我们可以创建一个新的 <code>本地日期</code> 实例通过调用静态出厂方法 <code>静态本地日期 (整年) 整月份，整日Ofmonth)</code> 和过去反序列化的 <code>int</code> 值。 我们再次使用 <code>Expression</code> API来完成这项任务。
最后，我们需要将我们的 <code>LocalDate</code> 的序列化器添加到 <a href="https://github.com/activej/activej/blob/v5.0-beta2/core-serializer/src/main/java/io/activej/serializer/SerializerBuilder.java" target="_blank">SerializerBuilder</a></p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">BinarySerializer&lt;LocalDateHolder&gt; serializer =</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    SerializerBuilder.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .with(LocalDate.class, ctx -&gt; new SerializerDefLocalDate())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build(LocalDateHolder.class);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>如果我们运行 <code>LocalDateSerializerExample#main</code> 方法，我们应该看到以下输出。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">将LocalDateHolder序列化。LocalDateHolder{date=2021-03-17}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">带有序列化的LocalDateHolder的字节数组。[-27, 15, 3, 17]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">解序列化的LocalDateHolder。LocalDateHolder{date=2021-03-17}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>你可以在以下网站上探索完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.0-beta2/examples/core/serializer/src/main/java/LocalDateSerializerExample.java" target="_blank">GitHub</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档页面导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/serializer"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« 概述</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/specializer"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">概述 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简单的对象序列化" class="table-of-contents__link">简单的对象序列化</a></li><li><a href="#泛型和接口" class="table-of-contents__link">泛型和接口</a></li><li><a href="#基于路径的序列化" class="table-of-contents__link">基于路径的序列化</a></li><li><a href="#固定大小和可置换字段的序列化" class="table-of-contents__link">固定大小和可置换字段的序列化</a></li><li><a href="#自定义序列化器" class="table-of-contents__link">自定义序列化器</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021年 ActiveJ LLC.保留所有权利</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.0ddb9244.js"></script>
<script src="/zh/assets/js/main.e382525e.js"></script>
</body>
</html>