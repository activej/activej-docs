<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="ActiveJ 5.1.1 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="ActiveJ 5.1.1 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">ActiveJ | 带有授权和会话管理的简单应用程序 | ActiveJ 5.1.1</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/zh/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/zh/tutorials/authorization-tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ | 带有授权和会话管理的简单应用程序 | ActiveJ 5.1.1"><meta data-react-helmet="true" name="description" content="使用ActiveJ平台，在大约100行的代码中创建一个具有授权和会话管理的Java网络应用程序。"><meta data-react-helmet="true" property="og:description" content="使用ActiveJ平台，在大约100行的代码中创建一个具有授权和会话管理的Java网络应用程序。"><meta data-react-helmet="true" name="keywords" content="java,适用于初学者,JAVA框架,指南,教程,网络应用,异步,spring,spring 替代方案,netty 替代方案,jetty 替代方案,许可证,服务器,客户,小程序"><link data-react-helmet="true" rel="shortcut icon" href="/zh/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/zh/tutorials/authorization-tutorial"><link data-react-helmet="true" rel="alternate" href="https://activej.io/tutorials/authorization-tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/tutorials/authorization-tutorial" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/tutorials/authorization-tutorial" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/tutorials/authorization-tutorial" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/zh/assets/js/runtime~main.3cf872df.js" as="script">
<link rel="preload" href="/zh/assets/js/main.a8465a0e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link" href="/zh/overview">文件</a><a class="navbar__item navbar__link navbar__link--active" href="/zh/tutorials/getting-started">教程</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh/blog">博客</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/getting-started">入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/template-engine-integration">模板引擎集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/http-decoder">HTTP解码器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh/tutorials/authorization-tutorial">授权和会话管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/getting-started-advanced">ActiveJ Docker AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/native-image">ActiveJ + GraalVM native image</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/using-react">ActiveJ + React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/todo-list-tutorial">ActiveJ + React (高级)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/tutorials/using-svelte">ActiveJ + Svelte</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">在这一页</button></div><div class="theme-doc-markdown markdown"><header><h1>授权和会话管理</h1></header><p>在这个例子中，我们将创建一个简单的授权应用，包括 <strong>登录</strong>/<strong>注册</strong> 场景 和会话管理。</p><p>ActiveJ不包括内置的授权模块或解决方案，因为这个过程可能会有很大的不同，取决于 项目的业务逻辑。 这个例子代表了一个简单的 &quot;最佳实践&quot;，你 ，可以根据你的需要进行扩展和修改。 你可以在以下网站找到完整的例子来源 <a href="https://github.com/activej/activej/blob/examples-5.1.1/examples/tutorials/auth" target="_blank">GitHub</a></p><p>在这个例子中，我们将只考虑使用ActiveJ <code>HttpServerLauncher</code> 和 <code>AsyncServlet</code>创建的 <a href="#creating-launcher">服务器</a>。 这种方法允许在大约100行的代码中创建一个嵌入式应用服务器，没有 额外的XML配置或第三方依赖。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="创建启动器">创建启动器<a aria-hidden="true" class="hash-link" href="#创建启动器" title="直接链接到标题">​</a></h2><p>让我们创建一个 <code>AuthLauncher</code>，它是应用程序的主要部分，因为它管理着应用程序的生命周期、路由 和授权过程。 我们将使用ActiveJ <code>HttpServerLauncher</code> 并扩展它。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public final class AuthLauncher extends HttpServerLauncher {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public static final String SESSION_ID = &quot;SESSION_ID&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthService loginService() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthServiceImpl();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Executor executor() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return newSingleThreadExecutor();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  StaticLoader staticLoader(Executor executor) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StaticLoader.ofClassPath(executor, &quot;site/&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  SessionStore&lt;String&gt; sessionStore() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return SessionStoreInMemory.&lt;String&gt;create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .withLifetime(Duration.ofDays(30));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  AsyncServlet servlet(SessionStore&lt;String&gt; sessionStore,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Named(&quot;public&quot;) AsyncServlet publicServlet, @Named(&quot;private&quot;) AsyncServlet privateServlet) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return SessionServlet.create(sessionStore, SESSION_ID, publicServlet, privateServlet);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>让我们更详细地探讨所提供的对象： - <strong>AuthService</strong> - 授权和注册逻辑</p><ul><li><strong>Executor</strong> - StaticLoader需要。</li><li><strong><a href="https://github.com/activej/activej/blob/v5.1.1/core-http/src/main/java/io/activej/http/loader/StaticLoader.java" target="_blank">StaticLoader</a></strong> - 从 <code>/site</code> 目录中加载静态内容。</li><li><strong><a href="https://github.com/activej/activej/blob/v5.1.1/core-http/src/main/java/io/activej/http/session/SessionStore.java" target="_blank">SessionStore</a></strong> - 便于存储有关会议的信息</li><li><strong><a href="https://github.com/activej/activej/blob/v5.1.1/core-http/src/main/java/io/activej/http/AsyncServlet.java" target="_blank">AsyncServlet</a></strong> <em>servlet</em> - 结合公共和私人servlet的主要servlet（用于授权和未授权会话）。 正如你所看到的，由于DI，这个servlet只需要两个没有自己的依赖性的servlet
现在让我们提供 <strong>public</strong> 和 <strong>private</strong> servlets。 <em> <code>AsyncServlet</code> </em>publicServlet* - 管理未经授权的会话。</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Named(&quot;public&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">AsyncServlet publicServlet(AuthService authService, SessionStore&lt;String&gt; store, StaticLoader staticLoader) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  StaticServlet staticServlet = StaticServlet.create(staticLoader, &quot;errorPage.html&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RoutingServlet.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[START REGION_3]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/login&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[END REGION_3]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(GET, &quot;/signup&quot;, StaticServlet.create(staticLoader, &quot;signup.html&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(GET, &quot;/login&quot;, StaticServlet.create(staticLoader, &quot;login.html&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[START REGION_4]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(POST, &quot;/login&quot;, request -&gt; request.loadBody()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          .then(() -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, String&gt; params = request.getPostParameters();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String username = params.get(&quot;username&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String password = params.get(&quot;password&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (authService.authorize(username, password)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              String sessionId = UUID.randomUUID().toString();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              return store.save(sessionId, &quot;My object saved in session&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .map($ -&gt; HttpResponse.redirect302(&quot;/members&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      .withCookie(HttpCookie.of(SESSION_ID, sessionId)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return staticServlet.serve(request);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[END REGION_4]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(POST, &quot;/signup&quot;, request -&gt; request.loadBody()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map($ -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, String&gt; params = request.getPostParameters();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String username = params.get(&quot;username&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String password = params.get(&quot;password&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (username != null &amp;&amp; password != null) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              authService.register(username, password);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return HttpResponse.redirect302(&quot;/login&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>让我们仔细看看我们是如何为Servlet设置路由的。 ActiveJ的方法类似于Express。 例如， 这里是未授权用户对主页的请求。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">.map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/login&quot;))</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>方法 <code>map(@Nullable HttpMethod method, String path, AsyncServlet servlet)</code> 将路由添加到 <a href="https://github.com/activej/activej/blob/v5.1.1/core-http/src/main/java/io/activej/http/RoutingServlet.java" target="_blank"><code>呼叫中心</code></a></p><ul><li><code>方法</code> （可选）是HTTP方法之一（<code>GET</code>， <code>POST</code>，等等）。</li><li><code>path</code> 是服务器上的路径。</li><li><code>servlet</code> 定义了请求处理的逻辑。 如果你需要在处理过程中从 <em>request</em> ，你可以使用一些数据。</li><li><code>request.getPathParameter(String key</code>/<code>request. etQueryParameter(密钥)</code> (<a href="/zh/http/examples#request-parameters-example">见查询参数使用示例</a>) 以提供所需参数的密钥并接收相应的字符串</li><li><code>request.getPostParameters()</code> 以获得所有请求参数的地图
<code>GET</code> 请求的路径是 <strong>&quot;/login&quot;</strong> 和 <strong>&quot;/signup&quot;</strong> 上传需要的HTML页面。 <code>POST</code> 请求的路径是 <strong>&quot;/login&quot;</strong> 和 <strong>&quot;/signup&quot;</strong> ，分别负责登录和注册的逻辑。</li></ul><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">.map(POST, &quot;/login&quot;, request -&gt; request.loadBody()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .then(() -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Map&lt;String, String&gt; params = request.getPostParameters();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      String username = params.get(&quot;username&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      String password = params.get(&quot;password&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (authService.authorize(username, password)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String sessionId = UUID.randomUUID().toString();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return store.save(sessionId, &quot;My object saved in session&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map($ -&gt; HttpResponse.redirect302(&quot;/members&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .withCookie(HttpCookie.of(SESSION_ID, sessionId)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return staticServlet.serve(request);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }))</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>请注意 <code>POST</code> <strong>&quot;/login&quot;</strong> 路线。 <em>serveFirstSuccessful()</em> 接收两个servlet并等待，直到其中一个 成功完成处理。 因此，如果授权失败，将返回 <strong>null</strong> 的承诺（<strong>AsyncServlet.NEXT</strong>）， ，这意味着失败。 在这种情况下，将创建一个简单的 <code>StaticServlet</code> ，以加载 <em>errorPage</em>。 成功登录将为用户生成一个会话 <em>id</em> ，并将字符串 <code>&quot;My saved object in session&quot;</code> 保存到会话存储中。 同时，它将把用户重定向到 <strong>&quot;/members&quot;</strong>。
现在，让我们来看看下一个处理授权会话的servlet。 <em> <code>AsyncServlet</code> </em>privateServlet* - 管理授权会话。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Named(&quot;private&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">AsyncServlet privateServlet(StaticLoader staticLoader) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RoutingServlet.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[START REGION_6]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/members&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[END REGION_6]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      //[START REGION_7]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(&quot;/members/*&quot;, RoutingServlet.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map(GET, &quot;/&quot;, StaticServlet.create(staticLoader, &quot;index.html&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          //[START REGION_8]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map(GET, &quot;/cookie&quot;, request -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          //[END REGION_8]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          .map(POST, &quot;/logout&quot;, request -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              HttpResponse.redirect302(&quot;/&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .withCookie(HttpCookie.of(SESSION_ID).withPath(&quot;/&quot;).withMaxAge(Duration.ZERO))));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  //[END REGION_7]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>首先，它将请求从主页重定向到 <strong>&quot;/members&quot;</strong>。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">.map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/members&quot;))</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>接下来，它负责处理所有在 <strong>&quot;/members&quot;</strong> 路径之后的请求。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">.map(&quot;/members/*&quot;, RoutingServlet.create()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map(GET, &quot;/&quot;, StaticServlet.create(staticLoader, &quot;index.html&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //[START REGION_8]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map(GET, &quot;/cookie&quot;, request -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //[END REGION_8]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map(POST, &quot;/logout&quot;, request -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpResponse.redirect302(&quot;/&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .withCookie(HttpCookie.of(SESSION_ID).withPath(&quot;/&quot;).withMaxAge(Duration.ZERO))));</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>请注意路径 <strong>&quot;/members/*&quot;</strong>。 <code>*</code> 是一个变量，用于路径的下一部分。 它指出，这个Servlet将处理任何在 <strong>&quot;/members/&quot;</strong>之后的路径段。 例如，这条路线。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">.map(GET, &quot;/cookie&quot;, request -&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><p>是对 <strong>&quot;/members/cookie&quot;</strong> 路径的GET请求。 该请求显示所有存储在会话中的cookies。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>一个请求可以有一个附件图，任何内容都可以被映射到某种类型，即 字符串。 默认情况下，请求没有附件。 在这种情况下，请求包含&#x27;cookies&#x27;作为附件，被映射到 <code>String</code> 类型。 :::
<strong>&quot;/members/logout&quot;</strong> 将用户注销，删除与此会话相关的所有cookies，并将用户重定向到主页。
在 <strong>public</strong> 和 <strong>private</strong> servlets设置完毕后，我们定义 <code>main()</code> 方法，它将启动我们的启动器。</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">public static void main(String[] args) throws Exception {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthLauncher launcher = new AuthLauncher();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  launcher.launch(args);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_2e3i clean-btn">拷贝</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="运行应用程序">运行应用程序<a aria-hidden="true" class="hash-link" href="#运行应用程序" title="直接链接到标题">​</a></h2><p>如果您想运行该示例， <a href="https://github.com/activej/activej/tree/v5.0-beta2" target="_blank" rel="noopener noreferrer">克隆ActiveJ</a> ，并将其导入 作为Maven项目。 查阅分支机构 <strong>v5.1.1</strong>。 在运行这个例子之前，构建项目（<strong>Ctrl F9</strong> for IntelliJ IDEA）。</p><p>打开 <code>AuthLauncher</code> 类并运行其 <em>main()</em> 方法。 然后打开你喜欢的浏览器，进入 <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">localhost:8080</a>。 尝试注册，然后登录。 当 登录时，查看你保存的cookie的会话。 你会看到以下内容： <code>我在会话中保存的对象</code>。 最后，尝试注销。 你也可以尝试用无效的登录名或密码登录。</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档页面导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/tutorials/http-decoder"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« <!-- -->HTTP解码器</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/tutorials/getting-started-advanced"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">ActiveJ Docker AWS<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#创建启动器" class="table-of-contents__link toc-highlight">创建启动器</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021年 ActiveJ LLC.保留所有权利</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.3cf872df.js"></script>
<script src="/zh/assets/js/main.a8465a0e.js"></script>
</body>
</html>