<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ 5.4.1 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ 5.4.1 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">Examples | ActiveJ 5.4.1</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/specializer/examples"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Examples | ActiveJ 5.4.1"><meta data-react-helmet="true" name="description" content="Please keep in mind that ActiveJ Specializer is an experimental project, use it with caution. It does not support lambda expressions and may have difficulty specializing non-trivial instances."><meta data-react-helmet="true" property="og:description" content="Please keep in mind that ActiveJ Specializer is an experimental project, use it with caution. It does not support lambda expressions and may have difficulty specializing non-trivial instances."><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/specializer/examples"><link data-react-helmet="true" rel="alternate" href="https://activej.io/specializer/examples" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/specializer/examples" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/specializer/examples" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/specializer/examples" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/assets/js/runtime~main.c7298556.js" as="script">
<link rel="preload" href="/assets/js/main.f8ed29c4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/overview">Docs</a><a class="navbar__item navbar__link" href="/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Async I/O</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Boot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Inject</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Serializer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Specializer</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specializer">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/specializer/examples">Examples</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Examples</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Please keep in mind that ActiveJ Specializer is an experimental project, use it with caution. It does not support lambda expressions and may have difficulty specializing non-trivial instances.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="simple-calculator">Simple Calculator<a aria-hidden="true" class="hash-link" href="#simple-calculator" title="Direct link to heading">â€‹</a></h2><p>We took this <a href="https://github.com/jparsec/jparsec/wiki/Tutorial" target="_blank" rel="noopener noreferrer">Parsec calculator tutorial</a> and adapted it slightly for ActiveJ Specializer. In the original tutorial, Parsec returns parsed expressions as double values:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Parser&lt;Double&gt; parser = new OperatorTable&lt;Double&gt;()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .infixl(op(&quot;+&quot;, (l, r) -&gt; l + r), 10)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .infixl(op(&quot;-&quot;, (l, r) -&gt; l - r), 10)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .infixl(Parsers.or(term(&quot;*&quot;), WHITESPACE_MUL).retn((l, r) -&gt; l * r), 20)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .infixl(op(&quot;/&quot;, (l, r) -&gt; l / r), 20)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .prefix(op(&quot;-&quot;, v -&gt; -v), 30)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .build(unit);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>ActiveJ Specializer shows its bests qualities when dealing with tree-like data structures. That is why we will be parsing expressions to AST:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">private static final Parser&lt;CalculatorExpression&gt; EXPRESSION = new OperatorTable&lt;CalculatorExpression&gt;()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixl(DELIMITERS.token(&quot;+&quot;).retn(Sum::new), 10)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixl(DELIMITERS.token(&quot;-&quot;).retn(Sub::new), 10)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixl(DELIMITERS.token(&quot;*&quot;).retn(Mul::new), 20)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixl(DELIMITERS.token(&quot;/&quot;).retn(Div::new), 20)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixl(DELIMITERS.token(&quot;%&quot;).retn(Mod::new), 20)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .prefix(DELIMITERS.token(&quot;-&quot;).retn(Neg::new), 30)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .infixr(DELIMITERS.token(&quot;^&quot;).retn(Pow::new), 40)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build(ATOM);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Assume we have a simple equation <code>3 + 2 * 4</code>. According to the parser, the following AST will be created:</p><div class="mermaid">
graph TD
+ --&gt; 3
+ --&gt; *
* --&gt; 2
* --&gt; 4
</div><p>Let&#x27;s test Specializer out:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public static void main(String[] args) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  double x = -1;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // manual code, superfast</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System.out.println(((2.0 + 2.0 * 2.0) * -x) + 5.0 + 1024.0 / (100.0 + 58.0) * 50.0 * 37.0 - 100.0 + 2.0 * (Math.pow(x, 2.0)) % 3.0);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CalculatorExpression expression = PARSER.parse(&quot;((2 + 2 * 2) * -x) + 5 + 1024 / (100 + 58) * 50 * 37 - 100 + 2 * x ^ 2 % 3&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System.out.println(expression);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // tree-walking evaluation, super slow</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System.out.println(expression.evaluate(x));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // specialized instance evaluation, about as fast as manual code</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  CalculatorExpression specialized = SPECIALIZER.specialize(expression);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System.out.println(specialized.evaluate(x));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>ActiveJ Specializer transforms the AST into a set of static final classes with baked-in values of the given
equation. JIT heavily optimizes and inlines these classes at runtime. The result is an optimized instance of an expression
that can be reused in case we compute an equation with an unknown value several times.</p><p>It&#x27;s time for some benchmarks. Let&#x27;s try to process an equation
<code>((2 + 2 * 2) * -x) + 5 + 1024 / (100 + 58) * 50 * 37 - 100 + 2 * x ^ 2 % 3</code> in three different ways and compare the performance:</p><ul><li>manually enter the equation</li><li>parse the equation to an AST and evaluate it <strong>without specialization</strong></li><li>parse the equation to an AST and evaluate it <strong>with specialization</strong></li></ul><p>The results of the benchmark are very illustrative:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W text"><pre tabindex="0" class="prism-code language-text codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Benchmark                        Mode  Cnt    Score   Error  Units</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CalculatorBenchmark.ast          avgt   10  828.924 Â± 8.369  ns/op</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CalculatorBenchmark.manual       avgt   10  115.985 Â± 1.009  ns/op</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CalculatorBenchmark.specialized  avgt   10  117.635 Â± 1.500  ns/op</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>As you can see, a manually typed equations and specialized AST were processed equally fast. ActiveJ Specializer sped
up AST processing 8 times.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/specializer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rpc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#simple-calculator" class="table-of-contents__link toc-highlight">Simple Calculator</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c7298556.js"></script>
<script src="/assets/js/main.f8ed29c4.js"></script>
</body>
</html>