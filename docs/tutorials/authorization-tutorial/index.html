<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">ActiveJ | Simple app with authorization and session management | ActiveJ</title><meta data-react-helmet="true" property="og:url" content="https://activej.io/docs/tutorials/authorization-tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ | Simple app with authorization and session management | ActiveJ"><meta data-react-helmet="true" name="description" content="Create a Java web application with authorization and session management in about 100 lines of code using ActiveJ platform."><meta data-react-helmet="true" property="og:description" content="Create a Java web application with authorization and session management in about 100 lines of code using ActiveJ platform."><meta data-react-helmet="true" name="keywords" content="java,for beginners,java framework,guide,tutorial,web application,async,spring,spring alternative,netty alternative,jetty alternative,authorization,server,client,servlet"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/docs/tutorials/authorization-tutorial"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/tutorials/authorization-tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/tutorials/authorization-tutorial" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b0b9f03e.css">
<link rel="preload" href="/assets/js/runtime~main.99e0d540.js" as="script">
<link rel="preload" href="/assets/js/main.6c8ce719.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/tutorials/getting-started">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/getting-started">Getting started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/template-engine-integration">Template Engine Integration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/http-decoder">HTTP Decoder</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/tutorials/authorization-tutorial">Authorization and Session Management</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/getting-started-advanced">ActiveJ + Docker + AWS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/using-react">ActiveJ + React</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/todo-list-tutorial">ActiveJ + React (advanced)</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Authorization and Session Management</h1></header><div class="markdown"><p>In this example we will create a simple authorization app with <strong>login</strong>/<strong>sign up</strong> scenarios
and session management.</p><p>ActiveJ doesn&#x27;t include built-in authorization modules or solutions, as this process may significantly vary depending
on the project&#x27;s business logic. This example represents a simple &quot;best practice&quot; which you
can extend and modify depending on your needs. You can find full example sources on <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/auth" target="_blank">GitHub</a></p><p>In the example we will consider only the <a href="#creating-launcher">server</a> which was created using ActiveJ <code>HttpServerLauncher</code> and
<code>AsyncServlet</code>. This approach allows to create an embedded application server in about 100 lines of code with no
additional XML configurations or third-party dependencies.</p><h2 id="creating-launcher">Creating Launcher</h2><p>Let&#x27;s create an <code>AuthLauncher</code>, which is the main part of the application as it manages the application lifecycle, routing
and authorization processes. We will use ActiveJ <code>HttpServerLauncher</code> and extend it:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_1" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_1">public final class AuthLauncher extends HttpServerLauncher {
  public static final String SESSION_ID = &quot;SESSION_ID&quot;;

  @Provides
  AuthService loginService() {
    return new AuthServiceImpl();
  }

  @Provides
  Executor executor() {
    return newSingleThreadExecutor();
  }

  @Provides
  private StaticLoader staticLoader(Executor executor) {
    return StaticLoader.ofClassPath(executor, &quot;site/&quot;);
  }

  @Provides
  SessionStore&lt;String&gt; sessionStore() {
    return SessionStoreInMemory.&lt;String&gt;create()
        .withLifetime(Duration.ofDays(30));
  }

  @Provides
  AsyncServlet servlet(SessionStore&lt;String&gt; sessionStore,
      @Named(&quot;public&quot;) AsyncServlet publicServlet, @Named(&quot;private&quot;) AsyncServlet privateServlet) {
    return SessionServlet.create(sessionStore, SESSION_ID, publicServlet, privateServlet);
  }
</code></pre><p>Let&#x27;s explore the provided objects in more detail:</p><ul><li><strong>AuthService</strong> - authorization and register logic</li><li><strong>Executor</strong> - needed for StaticLoader</li><li><strong><a href="https://github.com/activej/activej/blob/v4.3/core-http/src/main/java/io/activej/http/loader/StaticLoader.java" target="_blank">StaticLoader</a></strong> - loads static content from <code>/site</code> directory</li><li><strong><a href="https://github.com/activej/activej/blob/v4.3/core-http/src/main/java/io/activej/http/session/SessionStore.java" target="_blank">SessionStore</a></strong> - handy storage for information about sessions</li><li><strong><a href="https://github.com/activej/activej/blob/v4.3/core-http/src/main/java/io/activej/http/AsyncServlet.java" target="_blank">AsyncServlet</a></strong> <em>servlet</em> - the main servlet that combines public and private servlets (for authorized and unauthorized sessions). As you can see, due to DI, this servlet only requires two servlets without their own dependencies</li></ul><p>Now let&#x27;s provide the <strong>public</strong> and <strong>private</strong> servlets.</p><ul><li><code>AsyncServlet</code> <em>publicServlet</em> - manages unauthorized sessions:</li></ul><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_2" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_2">@Provides
@Named(&quot;public&quot;)
AsyncServlet publicServlet(AuthService authService, SessionStore&lt;String&gt; store, StaticLoader staticLoader) {
  return RoutingServlet.create()
      //[START REGION_3]
      .map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/login&quot;))
      //[END REGION_3]
      .map(GET, &quot;/signup&quot;, StaticServlet.create(staticLoader, &quot;signup.html&quot;))
      .map(GET, &quot;/login&quot;, StaticServlet.create(staticLoader, &quot;login.html&quot;))
      //[START REGION_4]
      .map(POST, &quot;/login&quot;, loadBody()
          .serveFirstSuccessful(
              request -&gt; {
                Map&lt;String, String&gt; params = request.getPostParameters();
                String username = params.get(&quot;username&quot;);
                String password = params.get(&quot;password&quot;);
                if (authService.authorize(username, password)) {
                  String sessionId = UUID.randomUUID().toString();

                  store.save(sessionId, &quot;My object saved in session&quot;);
                  return HttpResponse.redirect302(&quot;/members&quot;)
                      .withCookie(HttpCookie.of(SESSION_ID, sessionId));
                }
                return AsyncServlet.NEXT;
              },
              StaticServlet.create(staticLoader, &quot;errorPage.html&quot;)))
      //[END REGION_4]
      .map(POST, &quot;/signup&quot;, loadBody()
          .serve(request -&gt; {
            Map&lt;String, String&gt; params = request.getPostParameters();
            String username = params.get(&quot;username&quot;);
            String password = params.get(&quot;password&quot;);

            if (username != null &amp;&amp; password != null) {
              authService.register(username, password);
            }
            return HttpResponse.redirect302(&quot;/login&quot;);
          }));
}
</code></pre><p>Let&#x27;s take a closer look at how we set up routing for servlets. ActiveJ approach resembles Express. For example,
here&#x27;s the request to the homepage for unauthorized users:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_3" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_3">.map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/login&quot;))
</code></pre><p>Method <code>map(@Nullable HttpMethod method, String path, AsyncServlet servlet)</code> adds the route to the <a href="https://github.com/activej/activej/blob/v4.3/core-http/src/main/java/io/activej/http/RoutingServlet.java" target="_blank"><code>RoutingServlet</code></a></p><ul><li><code>method</code> (optional) is one of the HTTP methods (<code>GET</code>, <code>POST</code>, etc.)</li><li><code>path</code> is the path on the server</li><li><code>servlet</code> defines the logic of request processing. If you need to get some data from the <em>request</em> while processing you can use:<ul><li><code>request.getPathParameter(String key)</code>/<code>request.getQueryParameter(String key)</code> (<a href="/docs/async-io/http#request-parameters-example">see example of query parameter usage</a>)
to provide the key of the needed parameter and receive back a corresponding String</li><li><code>request.getPostParameters()</code> to get a Map of all request parameters</li></ul></li></ul><p><code>GET</code> requests with paths <strong>&quot;/login&quot;</strong> and <strong>&quot;/signup&quot;</strong> upload the needed HTML pages.
<code>POST</code> requests with paths <strong>&quot;/login&quot;</strong> and <strong>&quot;/signup&quot;</strong> take care of log in and sign up logic respectively:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_4" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_4">.map(POST, &quot;/login&quot;, loadBody()
    .serveFirstSuccessful(
        request -&gt; {
          Map&lt;String, String&gt; params = request.getPostParameters();
          String username = params.get(&quot;username&quot;);
          String password = params.get(&quot;password&quot;);
          if (authService.authorize(username, password)) {
            String sessionId = UUID.randomUUID().toString();

            store.save(sessionId, &quot;My object saved in session&quot;);
            return HttpResponse.redirect302(&quot;/members&quot;)
                .withCookie(HttpCookie.of(SESSION_ID, sessionId));
          }
          return AsyncServlet.NEXT;
        },
        StaticServlet.create(staticLoader, &quot;errorPage.html&quot;)))
</code></pre><p>Pay attention at <code>POST</code> <strong>&quot;/login&quot;</strong> route. <em>serveFirstSuccessful()</em> takes two servlets and waits until one of them
finishes processing successfully. So if authorization fails, a Promise of <strong>null</strong> will be returned (<strong>AsyncServlet.NEXT</strong>),
which means fail. In this case, a simple <code>StaticServlet</code> will be created to load the <em>errorPage</em>.
Successful log in will generate a session <em>id</em> for the user and will save string <code>&quot;My saved object in session&quot;</code> to session store.
Also it will redirect user to <strong>&quot;/members&quot;</strong>.</p><p>Now, let&#x27;s get to the next servlet that handles authorized sessions.</p><ul><li><code>AsyncServlet</code> <em>privateServlet</em> - manages authorized sessions:</li></ul><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_5" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_5">@Provides
@Named(&quot;private&quot;)
AsyncServlet privateServlet(StaticLoader staticLoader) {
  return RoutingServlet.create()
      //[START REGION_6]
      .map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/members&quot;))
      //[END REGION_6]
      //[START REGION_7]
      .map(&quot;/members/*&quot;, RoutingServlet.create()
          .map(GET, &quot;/&quot;, StaticServlet.create(staticLoader, &quot;index.html&quot;))
          //[START REGION_8]
          .map(GET, &quot;/cookie&quot;, request -&gt;
              HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))
          //[END REGION_8]
          .map(POST, &quot;/logout&quot;, request -&gt;
              HttpResponse.redirect302(&quot;/&quot;)
                  .withCookie(HttpCookie.of(SESSION_ID).withPath(&quot;/&quot;).withMaxAge(Duration.ZERO))));
  //[END REGION_7]
}
</code></pre><p>First, it redirects requests from homepage to <strong>&quot;/members&quot;</strong>:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_6" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_6">.map(&quot;/&quot;, request -&gt; HttpResponse.redirect302(&quot;/members&quot;))
</code></pre><p>Next, it takes care of all of the requests that go after <strong>&quot;/members&quot;</strong> path:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_7" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_7">.map(&quot;/members/*&quot;, RoutingServlet.create()
    .map(GET, &quot;/&quot;, StaticServlet.create(staticLoader, &quot;index.html&quot;))
    //[START REGION_8]
    .map(GET, &quot;/cookie&quot;, request -&gt;
        HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))
    //[END REGION_8]
    .map(POST, &quot;/logout&quot;, request -&gt;
        HttpResponse.redirect302(&quot;/&quot;)
            .withCookie(HttpCookie.of(SESSION_ID).withPath(&quot;/&quot;).withMaxAge(Duration.ZERO))));
</code></pre><p>Pay attention to the path <strong>&quot;/members/*&quot;</strong>.
<code>*</code> is a variable for the next part of the path. It states that this servlet will process any path segment that goes after <strong>&quot;/members/&quot;</strong>.
For example, this route:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_8" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_8">.map(GET, &quot;/cookie&quot;, request -&gt;
    HttpResponse.ok200().withBody(wrapUtf8(request.getAttachment(String.class))))
</code></pre><p>is a GET request for <strong>&quot;/members/cookie&quot;</strong> path. This request shows all cookies stored in the session.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>A request can have an attachment map where any content can be mapped to some type, i.e. String. By default, requests have no attachments. In this case, the request contains &#x27;cookies&#x27; as an attachment that&#x27;s mapped to the <code>String</code> type.</p></div></div><p><strong>&quot;/members/logout&quot;</strong> logs the user out, deletes all cookies related to this session and redirects the user to the homepage.</p><p>After <strong>public</strong> and <strong>private</strong> servlets are set up, we define <code>main()</code> method, which will start our launcher:</p><pre><code class="language-java" metastring="url=/examples/tutorials/auth/src/main/java/AuthLauncher.java tag=REGION_9" url="/examples/tutorials/auth/src/main/java/AuthLauncher.java" tag="REGION_9">public static void main(String[] args) throws Exception {
  AuthLauncher launcher = new AuthLauncher();
  launcher.launch(args);
}
</code></pre><h2 id="running-the-application">Running the application</h2><p>If you want to run the example, <a href="https://github.com/activej/activej">clone ActiveJ</a> and import it
as a Maven project. Check out branch <strong>v4.3</strong>. Before running the example, build the project (<strong>Ctrl + F9</strong> for IntelliJ IDEA).</p><p>Open <code>AuthLauncher</code> class and run its <em>main()</em> method.
Then open your favorite browser and go to <a href="http://localhost:8080">localhost:8080</a>. Try to sign up and then log in. When
logged in, check out your saved cookies for session. You will see the following content: <code>My saved object in session</code>.
Finally, try to log out. You can also try to log in with an invalid login or password.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorials/http-decoder"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Form Validation Using HTTP Decoder</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tutorials/getting-started-advanced"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploying ActiveJ Server to AWS Using Docker Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-launcher" class="table-of-contents__link">Creating Launcher</a></li><li><a href="#running-the-application" class="table-of-contents__link">Running the application</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.99e0d540.js"></script>
<script src="/assets/js/main.6c8ce719.js"></script>
</body>
</html>