<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ Blog Atom Feed"><title data-react-helmet="true">ActiveJ | Dataflow, distributed stream-based batch processing engine | ActiveJ</title><meta data-react-helmet="true" property="og:url" content="https://activej.io/docs/async-io/dataflow"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ActiveJ | Dataflow, distributed stream-based batch processing engine | ActiveJ"><meta data-react-helmet="true" name="description" content="Dataflow is an efficient tool for big data distributed applications. It offers a high-performance stream-based batch processing engine for working with partitions"><meta data-react-helmet="true" property="og:description" content="Dataflow is an efficient tool for big data distributed applications. It offers a high-performance stream-based batch processing engine for working with partitions"><meta data-react-helmet="true" name="keywords" content="java,dataflow,big data,streams,batch processing"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/docs/async-io/dataflow"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/async-io/dataflow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/async-io/dataflow" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.20d45dd5.css">
<link rel="preload" href="/assets/js/runtime~main.3053bc83.js" as="script">
<link rel="preload" href="/assets/js/main.96e02e81.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/async-io/http">Docs</a><a class="navbar__item navbar__link" href="/docs/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a class="navbar__item navbar__link" href="/about-us">About Us</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/async-io/http">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/getting-started">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/about-us">About Us</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Async I/O</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/eventloop">Eventloop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/promise">Promise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/csp">CSP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/datastream">Datastream</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async-io/net">Net</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/async-io/dataflow">Dataflow</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Boot</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/boot/launcher">Launcher</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/boot/servicegraph">Service Graph</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/boot/workers">Workers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/boot/config">Config</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Misc</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/misc/bytebuf">Bytebuf</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/misc/codec">Codec</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Inject</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/basic">Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/advanced">Advanced</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/benchmarks">Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Codegen</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/codegen/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/codegen/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Serializer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serializer/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serializer/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Specializer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/specializer/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/specializer/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">RPC</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rpc/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rpc/basic-examples">Basic Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rpc/key-value-storage">Key-Value Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rpc/memcached-like-application">Memcached-like Application</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/fs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/fs/examples">Examples</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Dataflow</h1></header><div class="markdown"><p>Dataflow is a distributed stream-based batch processing engine for big data applications.
You can create tasks on your client that will be executed on Dataflow servers with datasets. The task compiles into an
execution graph that will be executed on partitions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>In this example we will posts a simple Map-Reduce task to a cluster of Dataflow nodes.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>To run the examples, you need to clone ActiveJ from GitHub</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/activej/activej</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And import it as a Maven project. Check out tag <strong>v4.3</strong>. Before running the examples, build the project.
These examples are located at <code>activej/examples/core/dataflow</code></p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-create-a-dataflow-server-launcher"></a>1. Create a Dataflow Server Launcher<a class="hash-link" href="#1-create-a-dataflow-server-launcher" title="Direct link to heading">#</a></h3><p>First, we need to launch two Dataflow servers. Each of them will have its own &quot;items&quot; dataset that contains 10K random words that can overlap.
To create a Dataflow server launcher we&#x27;ll use pre-defined <a href="https://github.com/activej/activej/blob/v4.3/launchers/dataflow/src/main/java/io/activej/launchers/dataflow/DataflowServerLauncher.java" target="_blank"><b><code>DataflowServerLauncher</code></b></a> class that extends <a href="/docs/boot/launcher"><strong>Launcher</strong></a> class.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public final class DataflowServerLauncherExample extends DataflowServerLauncher {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  protected Module getOverrideModule() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return ModuleBuilder.create()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(CreateStringCountFunction.class)).toInstance(ofObject(CreateStringCountFunction::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(ExtractStringFunction.class)).toInstance(ofObject(ExtractStringFunction::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(StringCountReducer.class)).toInstance(ofObject(StringCountReducer::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(StreamSorterStorageFactory.class).toInstance(StreamMergeSorterStorageStub.FACTORY_STUB)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(Config.class).toInstance(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Config.create()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .with(&quot;dataflow.server.listenAddresses&quot;, args.length &gt; 0 ? args[0] : &quot;9000&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .with(&quot;dataflow.secondaryBufferPath&quot;, Util.createTempDir(&quot;dataflow-server-secondary-storage&quot;)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .build();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Provides</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @DatasetId(&quot;items&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  List&lt;String&gt; words() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    String file = args.length &gt; 1 ? args[1] : &quot;words1.txt&quot;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return new BufferedReader(new InputStreamReader(getClass().getResourceAsStream(file)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .lines()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .filter(s -&gt; !s.isEmpty())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .collect(toList());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  public static void main(String[] args) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    new DataflowServerLauncherExample().launch(args);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>First, override <code>getOverrideModule</code> method to create an abstract module with all the needed bindings: <a href="https://github.com/activej/activej/blob/v4.3/examples/core/dataflow/src/main/java/dto/CreateStringCountFunction.java" target="_blank"><b><code>CreateStringCountFunction</code></b></a>, <a href="https://github.com/activej/activej/blob/v4.3/examples/core/dataflow/src/main/java/dto/ExtractStringFunction.java" target="_blank"><b><code>ExtractStringFunction</code></b></a>, <a href="https://github.com/activej/activej/blob/v4.3/examples/core/dataflow/src/main/java/dto/StringCountReducer.java" target="_blank"><b><code>StringCountReducer</code></b></a>, <a href="https://github.com/activej/activej/blob/v4.3/extra/cloud-dataflow/src/main/java/io/activej/dataflow/node/NodeSort.java#L42" target="_blank"><b><code>StreamSorterStorageFactory</code></b></a> and <a href="/docs/boot/config">Config</a>.
Next, we create <em>words</em> method to efficiently retrieve a list of Strings from the <code>.txt</code> file.</p><p>Finally, we define <code>main</code> method for starting our launcher.</p><a href="https://github.com/activej/activej/blob/v4.3/examples/core/dataflow/src/main/java/DataflowServerLauncherExample.java" target="_blank"><b>See Dataflow server launcher source code on GitHub</b></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-create-a-dataflow-client-launcher-with-a-task"></a>2. Create a Dataflow Client Launcher with a task<a class="hash-link" href="#2-create-a-dataflow-client-launcher-with-a-task" title="Direct link to heading">#</a></h3><p>Let&#x27;s now create a Dataflow client launcher. We&#x27;ll make it by analogy with the server launcher. So we override <code>getOverrideModule</code> and provide the same required dependencies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public final class DataflowClientLauncherExample extends DataflowClientLauncher {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  private static final String DEFAULT_PARTITION = &quot;127.0.0.1:9000&quot;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Inject</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  DataflowClient client;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Inject</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  DataflowGraph graph;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Inject</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  Eventloop eventloop;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  @Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  protected Module getOverrideModule() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return ModuleBuilder.create()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(CreateStringCountFunction.class)).toInstance(ofObject(CreateStringCountFunction::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(ExtractStringFunction.class)).toInstance(ofObject(ExtractStringFunction::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(codec(StringCountReducer.class)).toInstance(ofObject(StringCountReducer::new))</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(StreamSorterStorageFactory.class).toInstance(StreamMergeSorterStorageStub.FACTORY_STUB)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .bind(Config.class).toInstance(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Config.create()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .with(&quot;dataflow.secondaryBufferPath&quot;, Util.createTempDir(&quot;dataflow-client-secondary-storage&quot;))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                .with(&quot;dataflow.partitions&quot;, args.length == 0 ? DEFAULT_PARTITION : String.join(&quot;,&quot;, args)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .build();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now let&#x27;s create a task for our Dataflow partitions. We&#x27;ll define it in the overridden Launcher&#x27;s main method <code>run</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">@Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">protected void run() throws InterruptedException {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  eventloop.execute(() -&gt; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    StringCountReducer reducer = new StringCountReducer();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ExtractStringFunction keyFunction = new ExtractStringFunction();</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Dataset&lt;String&gt; items = datasetOfId(&quot;items&quot;, String.class);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Dataset&lt;StringCount&gt; mappedItems = map(items, new CreateStringCountFunction(), StringCount.class);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    LocallySortedDataset&lt;String, StringCount&gt; locallySorted = localSort(mappedItems, String.class, keyFunction, naturalOrder());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    LocallySortedDataset&lt;String, StringCount&gt; locallyReduced = localReduce(locallySorted, reducer.inputToAccumulator(), StringCount.class, keyFunction);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Dataset&lt;StringCount&gt; reducedItems = repartitionReduce(locallyReduced, reducer.accumulatorToOutput(), StringCount.class);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    MergeCollector&lt;String, StringCount&gt; collector = new MergeCollector&lt;&gt;(reducedItems, client, keyFunction, naturalOrder(), false);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    StreamSupplier&lt;StringCount&gt; resultSupplier = collector.compile(graph);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    StreamConsumerToList&lt;StringCount&gt; resultConsumer = StreamConsumerToList.create();</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;\n *** Dataset graph:\n&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(reducedItems.toGraphViz());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;\n *** Compiled nodes graph:\n&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(graph.toGraphViz());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    graph.execute().both(resultSupplier.streamTo(resultConsumer))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .whenException(Throwable::printStackTrace)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .whenResult(() -&gt; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          System.out.println(&quot;Top 100 words:&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          resultConsumer.getList().stream().limit(100).forEach(System.out::println);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        })</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        .whenComplete(this::shutdown);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  });</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  awaitShutdown();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">public static void main(String[] args) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  new DataflowClientLauncherExample().launch(args);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This code does the following:</p><ol><li>Maps strings by creating <code>(&#x27;word&#x27;, 1)</code> pairs</li><li>Sorts the pairs in alphabetic order by the String value</li><li>Reduces the pairs by merging similar word pairs. For example, <code>(apple, 1)</code> and <code>(apple, 1)</code> will be reduced into <code>(apple, 2)</code></li><li>Distributes the pairs according to a provided rule. For example, if <strong>partition 1</strong> contains <code>(apple, 2)</code>, <code>(dog, 2)</code> and
<strong>partition 2</strong> contains <code>(apple, 3)</code>, <code>(dog, 1)</code> the result of repartitioning might be <code>(apple, 2)</code>, <code>(apple, 3)</code> on <strong>partition 1</strong> and
<code>(dog, 2)</code>, <code>(dog, 1)</code> on <strong>partition 2</strong>.</li><li>Repeats <strong>step 3</strong>. As a result of these steps, we receive a sorted and reduced dataset with unique items across all the partitions</li><li>With the help of collector, client pulls streams from all the nodes and merges them into a single stream</li><li>The stream is collected into a list that we can work with. In the example we simply print out the first 100 words</li></ol><p>Finally, we create <em>main</em> method that launches the client.</p><a href="https://github.com/activej/activej/blob/v4.3/examples/core/dataflow/src/main/java/DataflowClientLauncherExample.java" target="_blank"><b>See Dataflow server launcher source code on GitHub</b></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h3><p>First, launch two dataflow servers. You need to specify nodes&#x27; addresses and source files as program arguments.
<strong>Server Launcher 1</strong> arguments: <code>9000 words1.txt</code>. <strong>Server Launcher 2</strong> arguments: <code>9001 words2.txt</code>.
Next, launch dataflow client to post the created task to the servers. You&#x27;ll need to specify the ports of the partitions
as program arguments: <code>9000 9001</code>.</p><p>After everything is launched and the task is executed, in the console you will see the list of the first 100 words
collected from the two dataflow servers.
All the data flows between partitions are represented in sysout and can be transformed into the following graph:</p><div class="mermaid">
graph TB
    id5-.-&gt;id13
    subgraph #2
    id1(SupplierOfId)--&gt;id2(Map)
    id2--&gt;id3(Sort)
    id3--&gt;id4(Reduce Simple)
    id4--&gt;id5(Shard)
    id5-.-&gt;id6(Reduce)
    id6--&gt;id7(Upload)
    end
    id12-.-&gt;id6
    subgraph #1
    id8(SupplierOfId)--&gt;id9(Map)
    id9--&gt;id10(Sort)
    id10--&gt;id11(Reduce Simple)
    id11--&gt;id12(Shard)
    id12-.-&gt;id13(Reduce)
    id13--&gt;id14(Upload)
    end
</div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/async-io/net"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Net</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/boot/launcher"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Launcher Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link">Example</a><ul><li><a href="#1-create-a-dataflow-server-launcher" class="table-of-contents__link">1. Create a Dataflow Server Launcher</a></li><li><a href="#2-create-a-dataflow-client-launcher-with-a-task" class="table-of-contents__link">2. Create a Dataflow Client Launcher with a task</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3053bc83.js"></script>
<script src="/assets/js/main.96e02e81.js"></script>
</body>
</html>