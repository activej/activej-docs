<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">Key-Value Storage | ActiveJ</title><meta data-react-helmet="true" property="og:url" content="https://activej.io/docs/rpc/key-value-storage"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Key-Value Storage | ActiveJ"><meta data-react-helmet="true" name="description" content="Create a key-value storage with high performance RPC communication protocol"><meta data-react-helmet="true" property="og:description" content="Create a key-value storage with high performance RPC communication protocol"><meta data-react-helmet="true" name="keywords" content="java,java framework,tutorial,guide,rpc,client-server,web application,key-value storage"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/docs/rpc/key-value-storage"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/rpc/key-value-storage" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/docs/rpc/key-value-storage" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b0b9f03e.css">
<link rel="preload" href="/assets/js/runtime~main.99e0d540.js" as="script">
<link rel="preload" href="/assets/js/main.6c8ce719.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/overview">Docs</a><a class="navbar__item navbar__link" href="/docs/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/favicon.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ActiveJ</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/getting-started">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Async I/O</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/eventloop">Eventloop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/promise">Promise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/csp">CSP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/datastream">Datastream</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/net">Net</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/async-io/dataflow">Dataflow</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Boot</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/boot/launcher">Launcher</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/boot/servicegraph">Service Graph</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/boot/workers">Workers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/boot/config">Config</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Misc</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/bytebuf">Bytebuf</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/misc/codec">Codec</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Inject</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/basic">Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/advanced">Advanced</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/benchmarks">Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inject/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Codegen</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/codegen/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/codegen/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Serializer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serializer/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serializer/examples">Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Specializer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/specializer/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/specializer/examples">Examples</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">RPC</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rpc/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rpc/basic-examples">Basic Examples</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/rpc/key-value-storage">Key-Value Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rpc/memcached-like-application">Memcached-like Application</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/fs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/fs/examples">Examples</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Key-Value Storage</h1></header><div class="markdown"><p>In this guide we will create a remote key-value storage which will have 2 basic operations: <code>put</code> and <code>get</code>. When
writing distributed application the common concern is what protocol to use for communication. There are two main
options:</p><ul><li>HTTP/REST</li><li>RPC</li></ul><p>While HTTP is more popular and well-specified, it has some overhead. When performance is a significant aspect of application,
you should use something faster. For this purpose ActiveJ RPC was designed based on
fast serializers and custom optimized communication protocol that allows to significantly improve application performance.</p><h2 id="what-you-will-need">What you will need:</h2><ul><li>IDE or terminal</li><li>JDK 1.8+</li><li>Maven 3.0+</li></ul><h2 id="to-proceed-with-this-guide-you-have-2-options">To proceed with this guide you have 2 options:</h2><ul><li>Download and run <a href="#working-example">working example</a></li><li>Follow <a href="#step-by-step-guide">step-by-step guide</a></li></ul><h2 id="working-example">Working Example</h2><p>To run the example in IDE, <a href="https://github.com/activej/activej.git">clone ActiveJ project</a> locally first:</p><pre><code class="language-bash">git clone https://github.com/activej/activej.git
</code></pre><p>And import it as a Maven project. Check out branch <strong>v4.3</strong>.</p><p>Before running the example, build the project (<strong>Ctrl + F9</strong> for IntelliJ IDEA).</p><p>Then, go to <a href="#testing">testing</a> section.</p><h2 id="step-by-step-guide">Step-by-step guide</h2><h3 id="1-set-up-the-project">1. Set up the project</h3><p>First, create a folder for application and build an appropriate project structure:</p><pre><code class="language-text">remote-key-value-storage
â””â”€â”€ pom.xml
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ GetRequest.java
            â””â”€â”€ GetResponse.java
            â””â”€â”€ PutRequest.java
            â””â”€â”€ PutResponse.java
            â””â”€â”€ KeyValueStore.java
            â””â”€â”€ ServerModule.java
            â””â”€â”€ ServerLauncher.java
            â””â”€â”€ ClientModule.java
            â””â”€â”€ ClientLauncher.java
</code></pre><p>Next, configure your <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/pom.xml" target="_blank">pom.xml</a> file like this:</p><pre><code class="language-xml" metastring="url=/examples/tutorials/rpc-kv-storage/pom.xml" url="/examples/tutorials/rpc-kv-storage/pom.xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;io.activej&lt;/groupId&gt;
  &lt;artifactId&gt;tutorial-rpc-kv-storage&lt;/artifactId&gt;
  &lt;version&gt;4.3&lt;/version&gt;

  &lt;name&gt;Tutorials : Rpc-KV-Storage&lt;/name&gt;

  &lt;properties&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.activej&lt;/groupId&gt;
      &lt;artifactId&gt;activej-boot&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.activej&lt;/groupId&gt;
      &lt;artifactId&gt;activej-rpc&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;version&gt;1.2.3&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;ClientLauncher&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;java&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;mainClass&gt;ClientLauncher&lt;/mainClass&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;ServerLauncher&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;java&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;mainClass&gt;ServerLauncher&lt;/mainClass&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;

</code></pre><h3 id="2-define-basic-app-functionality">2. Define basic app functionality</h3><p>Since we have two basic operations to implement (<code>put</code> and <code>get</code>), let&#x27;s start with writing down classes that will be used for communication between client and server, specifically <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/PutRequest.java" target="_blank">PutRequest</a>, <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/PutResponse.java" target="_blank">PutResponse</a>,</p><a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/GetRequest.java" target="_blank">GetRequest</a>, and <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/GetResponse.java" target="_blank">GetResponse</a>. Instances of these classes will be serialized by lightning-fast serializer library [ActiveJ Serializer](/docs/serializer/overview). It requires some meta information about these classes, which is provided by appropriate annotations. The basic rules are:<ul><li>Use <a href="https://github.com/activej/activej/blob/v4.3/core-serializer/src/main/java/io/activej/serializer/annotations/Serialize.java" target="_blank">@Serialize</a> annotation with an order number on the getter of property. Ordering provides better compatibility in case classes are changed.</li><li>Use <a href="https://github.com/activej/activej/blob/v4.3/core-serializer/src/main/java/io/activej/serializer/annotations/Deserialize.java" target="_blank">@Deserialize</a> annotation with a property name (which should be the same as the one in the getter) in constructor.</li><li>Use <a href="https://github.com/activej/activej/blob/v4.3/core-serializer/src/main/java/io/activej/serializer/annotations/SerializeNullable.java" target="_blank">@SerializeNullable</a> on properties that can have null values.</li></ul><p>Therefore, classes for communication should look like following:</p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/PutRequest.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/PutRequest.java" tag="EXAMPLE">public class PutRequest {

  private final String key;
  private final String value;

  public PutRequest(@Deserialize(&quot;key&quot;) String key, @Deserialize(&quot;value&quot;) String value) {
    this.key = key;
    this.value = value;
  }

  @Serialize(order = 0)
  public String getKey() {
    return key;
  }

  @Serialize(order = 1)
  public String getValue() {
    return value;
  }
}
</code></pre><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/PutResponse.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/PutResponse.java" tag="EXAMPLE">public class PutResponse {
  private final String previousValue;

  public PutResponse(@Deserialize(&quot;previousValue&quot;) String previousValue) {
    this.previousValue = previousValue;
  }

  @Serialize(order = 0)
  @SerializeNullable
  public String getPreviousValue() {
    return previousValue;
  }

  @Override
  public String toString() {
    return &quot;{previousValue=&#x27;&quot; + previousValue + &#x27;\&#x27;&#x27; + &#x27;}&#x27;;
  }
}
</code></pre><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/GetRequest.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/GetRequest.java" tag="EXAMPLE">public class GetRequest {

  private final String key;

  public GetRequest(@Deserialize(&quot;key&quot;) String key) {
    this.key = key;
  }

  @Serialize(order = 0)
  public String getKey() {
    return key;
  }
}
</code></pre><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/GetResponse.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/GetResponse.java" tag="EXAMPLE">public class GetResponse {
  private final String value;

  public GetResponse(@Deserialize(&quot;value&quot;) String value) {
    this.value = value;
  }

  @Serialize(order = 0)
  @SerializeNullable
  public String getValue() {
    return value;
  }

  @Override
  public String toString() {
    return &quot;{value=&#x27;&quot; + value + &#x27;\&#x27;&#x27; + &#x27;}&#x27;;
  }
}
</code></pre><p>Next, let&#x27;s write a simple implementation of key-value storage <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/KeyValueStore.java" target="_blank">@KeyValueStore</a></p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/KeyValueStore.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/KeyValueStore.java" tag="EXAMPLE">public class KeyValueStore {

  private final Map&lt;String, String&gt; store = new HashMap&lt;&gt;();

  public String put(String key, String value) {
    return store.put(key, value);
  }

  public String get(String key) {
    return store.get(key);
  }
}
</code></pre><h3 id="3-create-client-and-server">3. Create client and server</h3><p>Now, let&#x27;s write down an <a href="https://github.com/activej/activej/blob/v4.3/core-inject/src/main/java/io/activej/inject/module/AbstractModule.java" target="_blank">AbstractModule</a> for the RPC server using <a href="/docs/inject/overview">ActiveJ Inject</a> dependency injection library to handle the <code>get</code> and <code>put</code> requests.</p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/ServerModule.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/ServerModule.java" tag="EXAMPLE">public class ServerModule extends AbstractModule {
  private static final int RPC_SERVER_PORT = 5353;

  @Provides
  Eventloop eventloop() {
    return Eventloop.create()
        .withFatalErrorHandler(rethrowOnAnyError());
  }

  @Provides
  KeyValueStore keyValueStore() {
    return new KeyValueStore();
  }

  @Provides
  RpcServer rpcServer(Eventloop eventloop, KeyValueStore store) {
    return RpcServer.create(eventloop)
        .withSerializerBuilder(SerializerBuilder.create())
        .withMessageTypes(PutRequest.class, PutResponse.class, GetRequest.class, GetResponse.class)
        .withHandler(PutRequest.class, req -&gt; Promise.of(new PutResponse(store.put(req.getKey(), req.getValue()))))
        .withHandler(GetRequest.class, req -&gt; Promise.of(new GetResponse(store.get(req.getKey()))))
        .withListenPort(RPC_SERVER_PORT);
  }
}
</code></pre><p>As you can see, in order to properly create an <a href="https://github.com/activej/activej/blob/v4.3/cloud-rpc/src/main/java/io/activej/rpc/server/RpcServer.java" target="_blank">RpcServer</a> we should indicate all the classes that will be sent between client and server, and specify the appropriate <a href="https://github.com/activej/activej/blob/v4.3/cloud-rpc/src/main/java/io/activej/rpc/server/RpcRequestHandler.java" target="_blank">RpcRequestHandler</a> for each request class.</p><p>We represent them as the third arguments in these lines using lambdas.</p><pre><code class="language-java">.withHandler(PutRequest.class, PutResponse.class, req -&gt; Promise.of(new PutResponse(store.put(req.getKey(), req.getValue()))))
.withHandler(GetRequest.class, GetResponse.class, req -&gt; Promise.of(new GetResponse(store.get(req.getKey()))))
</code></pre><p>Next, create <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/ServerLauncher.java" target="_blank">ServerLauncher</a> for the RPC server. Use <a href="/docs/boot/launcher">ActiveJ Launcher</a> to manage application lifecycle:</p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/ServerLauncher.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/ServerLauncher.java" tag="EXAMPLE">public class ServerLauncher extends Launcher {
  @Inject
  private RpcServer server;

  @Override
  protected Module getModule() {
    return combine(
        ServiceGraphModule.create(),
        new ServerModule());
  }

  @Override
  protected void run() throws Exception {
    awaitShutdown();
  }

  public static void main(String[] args) throws Exception {
    ServerLauncher launcher = new ServerLauncher();
    launcher.launch(args);
  }
}
</code></pre><p>Since we extend <strong>Launcher</strong>, we will also override 2 methods: <em>getModule</em> to provide <a href="/docs/boot/servicegraph"><strong>ServiceGraphModule</strong></a> and <em>run</em> to describe the main logic of the example.</p><p>Now, let&#x27;s write the RPC client. We should indicate all the classes that will be used for communication and specify the <a href="/docs/rpc/basic-examples#round-robin-strategy">RPC strategy</a>. All strategies can be combined, but since we have only one server, we will use <a href="https://github.com/activej/activej/blob/v4.3/cloud-rpc/src/main/java/io/activej/rpc/client/sender/RpcStrategySingleServer.java" target="_blank">single-server</a> strategy:</p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/ClientModule.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/ClientModule.java" tag="EXAMPLE">public class ClientModule extends AbstractModule {
  private static final int RPC_SERVER_PORT = 5353;

  @Provides
  Eventloop eventloop() {
    return Eventloop.create()
        .withFatalErrorHandler(rethrowOnAnyError())
        .withCurrentThread();
  }

  @Provides
  RpcClient rpcClient(Eventloop eventloop) {
    return RpcClient.create(eventloop)
        .withConnectTimeout(Duration.ofSeconds(1))
        .withSerializerBuilder(SerializerBuilder.create())
        .withMessageTypes(PutRequest.class, PutResponse.class, GetRequest.class, GetResponse.class)
        .withStrategy(RpcStrategies.server(new InetSocketAddress(&quot;localhost&quot;, RPC_SERVER_PORT)));
  }
}
</code></pre><p>Let&#x27;s also build <a href="https://github.com/activej/activej/blob/v4.3/examples/tutorials/rpc-kv-storage/src/main/java/ClientLauncher.java" target="_blank">ClientLauncher</a>. In <code>run()</code> we will consider command line arguments and make appropriate requests to <strong>RpcServer</strong></p><pre><code class="language-java" metastring="url=/examples/tutorials/rpc-kv-storage/src/main/java/ClientLauncher.java tag=EXAMPLE" url="/examples/tutorials/rpc-kv-storage/src/main/java/ClientLauncher.java" tag="EXAMPLE">public class ClientLauncher extends Launcher {
  private static final int TIMEOUT = 1000;

  @Inject
  private RpcClient client;

  @Inject
  Eventloop eventloop;

  @Override
  protected Module getModule() {
    return combine(
        ServiceGraphModule.create(),
        new ClientModule());
  }

  @Override
  protected void run() throws Exception {
    if (args.length &lt; 2) {
      System.err.println(&quot;Command line args:\n\t--put key value\n\t--get key&quot;);
      return;
    }

    switch (args[0]) {
      case &quot;--put&quot;:
        CompletableFuture&lt;PutResponse&gt; future1 = eventloop.submit(() -&gt;
            client.sendRequest(new PutRequest(args[1], args[2]), TIMEOUT)
        );
        PutResponse putResponse = future1.get();
        System.out.println(&quot;PutResponse: &quot; + putResponse);
        break;
      case &quot;--get&quot;:
        CompletableFuture&lt;GetResponse&gt; future2 = eventloop.submit(() -&gt;
            client.sendRequest(new GetRequest(args[1]), TIMEOUT)
        );
        GetResponse getResponse = future2.get();
        System.out.println(&quot;GetResponse: &quot; + getResponse);
        break;
      default:
        throw new RuntimeException(&quot;Unsupported option: &quot; + args[0]);
    }
  }

  public static void main(String[] args) throws Exception {
    ClientLauncher launcher = new ClientLauncher();
    launcher.launch(args);
  }
}
</code></pre><p>Congratulations! We&#x27;ve finished writing the code for this app.</p><h2 id="testing">Testing</h2><p>First, launch server. Open <strong>ServerLauncher</strong> class and run its <em>main()</em> method.</p><p>Then make a <code>PUT</code> request. Open <strong>ClientLauncher</strong> class which is located at <strong>activej -&gt; examples -&gt; tutorials -&gt; rpc-kv-storage</strong>
and set up program arguments to <code>--put key1 value1</code>. For IntelliJ IDEA: <code>Run -&gt; Edit configurations -&gt;
|Run/Debug Configurations -&gt; |Program arguments -&gt; --put key1 value1||</code>. Then run launcher&#x27;s <em>main()</em> method.</p><p>You will see the following output:</p><pre><code class="language-bash">PutResponse: {previousValue=&#x27;null&#x27;}
</code></pre><p>Finally, make a <code>GET</code> request.</p><p>Open <strong>ClientLauncher</strong> class again and set up program arguments to <code>--get key1</code>. For IntelliJ IDEA: <code>Run -&gt;
Edit configurations -&gt; |Run/Debug Configurations -&gt; |Program arguments -&gt; --get key1||</code>. Then run <em>main()</em> method of the
client launcher.</p><p>You will see the following output:</p><pre><code class="language-bash">GetResponse: {value=&#x27;value1&#x27;}
</code></pre><p>Congratulations, you&#x27;ve just created a remote key-value storage with RPC communication protocol!</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/rpc/basic-examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Basic Examples</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/rpc/memcached-like-application"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Memcached-like Application Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-you-will-need" class="table-of-contents__link">What you will need:</a></li><li><a href="#to-proceed-with-this-guide-you-have-2-options" class="table-of-contents__link">To proceed with this guide you have 2 options:</a></li><li><a href="#working-example" class="table-of-contents__link">Working Example</a></li><li><a href="#step-by-step-guide" class="table-of-contents__link">Step-by-step guide</a><ul><li><a href="#1-set-up-the-project" class="table-of-contents__link">1. Set up the project</a></li><li><a href="#2-define-basic-app-functionality" class="table-of-contents__link">2. Define basic app functionality</a></li><li><a href="#3-create-client-and-server" class="table-of-contents__link">3. Create client and server</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.99e0d540.js"></script>
<script src="/assets/js/main.6c8ce719.js"></script>
</body>
</html>