<!DOCTYPE html>
<html lang="en">
<head>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
    <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176574648-1');
    </script>
    
    <link rel='stylesheet' href='/static/css/pygment_trac.css'/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <title>ActiveJ | CSP, efficient I/O communication between channels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content=" Efficient Java CSP (Communicating Sequential Process) implementation for I/O communication ">
    <meta name="keywords" content=" java,csp,communication sequential process,java csp,go language,go ">
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
    <meta name="og:description" content="ActiveJ is an alternative Java platform built from the ground up as a replacement of Spring, Spark, Quarkus, Micronauts, and other solutions. It is minimalistic, boilerplate-free, and provides outstanding performance." />
    <meta name="og:image" content="https://activej.io/static/images/AJ_Card.jpeg" />
    <meta name="og:title" content="ActiveJ - An Alternative Java platform built for web, high load, and cloud development" />
</head>
<body>
    <div class="navbar-container-wrapper">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
            <ul class="navbar-nav-visible mr-auto mt-1 mt-lg-0">
                <div class="logo-link-title mr-5">
                    <img src="/favicon.png" style="max-width: 25px">
                    
                    
                    <a class="navbar-nav__link logo-link-title" href="/" style="margin-left: 5px">ActiveJ</a>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </div>
            </ul>
            <button class="navbar-toggler m-1 ml-auto" type="button" data-toggle="collapse" data-target="#navbarToggler"
                    aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarToggler">
                <div class="container">
                    
                    
                    <ul class="navbar-nav navbar-nav-visible mr-auto mt-1 mt-lg-0">
                        
                        <li>
                            <a class="navbar-nav__link nav-expanded" href="/tutorials/getting-started.html">
                                Tutorials
                            </a>
                        </li>
                        
                        <li>
                            <a class="navbar-nav__link nav-expanded" href="/http.html">
                                Docs
                            </a>
                        </li>
                        
                    </ul>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </div>
                <span>
              <ul class="navbar-nav expanded-links navbar-nav-visible mr-auto mt-1 mt-lg-0">
                  <li class="dropdown">
                    <a class="nav-link nav-expanded">Components</a>
                    <ul class="dropdown__content">
                        
                            <div class="dropdown__content-wrapper">
                                
                                    <a href="https://activej.io" class="dropdown__content__item  selected-link ">
                                        <li>
                                            <div href="https://activej.io">ActiveJ</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Redefining Java for modern web applications </p>
                                    </a>
                                
                                    <a href="https://inject.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://inject.activej.io">ActiveJ Inject</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Lightning-fast and ultimately powerful DI library </p>
                                    </a>
                                
                                    <a href="https://serializer.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://serializer.activej.io">ActiveJ Serializer</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> The fastest JVM serializer in the world </p>
                                    </a>
                                
                                    <a href="https://codegen.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://codegen.activej.io">ActiveJ Codegen</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Dynamic bytecode generation without overhead of reflection </p>
                                    </a>
                                
                                    <a href="https://specializer.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://specializer.activej.io">ActiveJ Specializer</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> A little bit of magic to speed up your code </p>
                                    </a>
                                
                                    <a href="https://rpc.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://rpc.activej.io">ActiveJ RPC</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Lightning-fast binary protocol for microservices architecture </p>
                                    </a>
                                
                                    <a href="https://fs.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://fs.activej.io">ActiveJ FS</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Tiny abstraction for managing local, remote, and distributed FS </p>
                                    </a>
                                
                           </div>
                        
                    </ul>
                </li>
                  <li><a class="navbar-nav__link" href="https://activej.io/blog/release-notes.html">Blog</a> </li>
                <li><a class="navbar-nav__link" href="http://uikernel.io">UIKernel</a></li>
                <li><a class="navbar-nav__link" href="https://adkernel.com">AdKernel</a></li>
                <li><a class="navbar-nav__link" href="https://github.com/activej/activej">GitHub</a></li>
                <li><a class="navbar-nav__link" href="/about.html">About us</a></li>
              </ul>
            </span>
            </div>
        </nav>
    </div>
</div>

    <div class="content">
        
            <div class="container">
                <div class="row">
                    <div class="px-0 mb-3 sidebar">
    
<h3>Async I/O</h3>
<ul>
    
    
    <li>
        <a href="/http.html">HTTP</a>
    </li>
    
    
    
    <li>
        <a href="/eventloop.html">Eventloop</a>
    </li>
    
    
    
    <li>
        <a href="/promise.html">Promise</a>
    </li>
    
    
    
    <li class="sidebar-item-selected-wrapper">
        <div class="sidebar-item-selected">
            <a href="/csp.html">CSP</a>
        </div>
    </li>
    
    
    
    <li>
        <a href="/datastream.html">Datastream</a>
    </li>
    
    
    
    <li>
        <a href="/net.html">Net</a>
    </li>
    
    
    
    <li>
        <a href="/dataflow.html">Dataflow</a>
    </li>
    
    
</ul>

<h3>Boot</h3>
<ul>
    
    
    <li>
        <a href="/launcher.html">Launcher</a>
    </li>
    
    
    
    <li>
        <a href="/service-graph.html">Service Graph</a>
    </li>
    
    
    
    <li>
        <a href="/workers.html">Workers</a>
    </li>
    
    
    
    <li>
        <a href="/config.html">Config</a>
    </li>
    
    
</ul>

<h3>Misc</h3>
<ul>
    
    
    <li>
        <a href="/bytebuf.html">ByteBuf</a>
    </li>
    
    
    
    <li>
        <a href="/codec.html">Codec</a>
    </li>
    
    
</ul>

</div>
<div class="pr-3 markdown-content docs-content">
    <div class="status-wrapper">
        <h1>CSP </h1>
    </div>
    <p>CSP (stands for Communicating Sequential Process) provides I/O communication between channels and was inspired by the Go 
language approach.</p>

<h2 id="features">Features:</h2>
<ul>
  <li>High performance and throughput speed</li>
  <li>Optimized for working with medium-sized objects (like <a href="bytebuf.html">ByteBufs</a>)</li>
  <li>CSP has reach DSL, which provides a simple programming model</li>
  <li>Has an asynchronous back pressure management</li>
</ul>

<h2 id="channel-supplier-and-channel-consumer">Channel Supplier and Channel Consumer</h2>
<p>CSP communication is conducted via <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/ChannelSupplier.java"><strong>ChannelSupplier</strong></a> 
and <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/ChannelConsumer.java"><strong>ChannelConsumer</strong></a>, which provide and accept some data 
respectively. Each consecutive request to these channels should be called only after the previous request finishes. CSP 
uses <a href="/promise.html">Promises</a> to manage it.</p>

<p><strong>ChannelSupplier</strong> has a <em>get()</em> method that returns a <a href="promise.html"><strong>Promise</strong></a> of the provided value. Until 
this <strong>Promise</strong> is completed either with a result or with an exception, the method shouldn’t be called again. Also 
note, that if <em>get()</em> returns <strong>Promise</strong> of <em>null</em>, this represents the end of the stream and no additional data 
should be requested from this supplier.</p>

<p><strong>ChannelConsumer</strong> has an <em>accept(@Nullable T value)</em> method which returns a <strong>Promise</strong> of <em>null</em> as a marker of 
completion of the accepting. Until this <strong>Promise</strong> completes, <em>accept()</em> method should not be called again. By analogy 
with the <strong>ChannelSupplier</strong>, if a <em>null</em> value is accepted, it represents the end of the stream.</p>

<p>Here is an example of communication between <strong>ChannelSupplier</strong> and <strong>ChannelConsumer</strong>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doProcess</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">input</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
			<span class="o">.</span><span class="na">whenComplete</span><span class="o">((</span><span class="n">data</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">output</span><span class="o">.</span><span class="na">acceptEndOfStream</span><span class="o">()</span>
							<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">completeProcess</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">()</span> <span class="o">+</span> <span class="sc">'('</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">+</span> <span class="sc">')'</span><span class="o">;</span>

					<span class="n">output</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
							<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">doProcess</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">});</span>
<span class="o">}</span></code></pre></figure>

<h2 id="channel-queue">Channel Queue</h2>
<p>Another important concept of CSP is <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/queue/ChannelQueue.java"><strong>ChannelQueue</strong></a> 
interface and its implementations: <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/queue/ChannelBuffer.java"><strong>ChannelBuffer</strong></a> 
and <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/queue/ChannelZeroBuffer.java"><strong>ChannelZeroBuffer</strong></a>. They provide communication between <em>Consumers</em> and <em>Suppliers</em> and allow them to create chains of these 
pipes if needed.</p>

<p>Basically, these buffers pass objects from <strong>ChannelConsumer</strong> to <strong>ChannelSupplier</strong> as soon as the 
queue gets a free space. This process is controlled by <strong>Promise</strong>s. You can manually set the size of <strong>ChannelBuffer</strong>.
<strong>ChannelZeroBuffer</strong> doesn’t store any values but simply passes them one by one from <strong>ChannelConsumer</strong> to 
<strong>ChannelSupplier</strong>.</p>

<p>Here is a simple example of working with buffers of items:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">buffer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">isSaturated</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">getSupplier</span><span class="o">().</span><span class="na">suspend</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">produce</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">while</span> <span class="o">(!</span><span class="n">buffer</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
		<span class="no">T</span> <span class="n">item</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">send</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
			<span class="n">sendEndOfStream</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="comparison-to-datastream">Comparison to Datastream</h2>
<p>CSP has a lot in common with the <a href="datastream.html">Datastream</a> module. 
Although they were both designed for I/O processing, there are several important distinctions:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Datastream</th>
      <th>CSP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Overhead:</strong></td>
      <td>Extremely low: stream can be started with 1 virtual call, short-circuit evaluation optimizes performance</td>
      <td>No short-circuit evaluation, overhead is higher</td>
    </tr>
    <tr>
      <td><strong>Throughput speed:</strong></td>
      <td>Extremely fast (<em>360 880 548 ops/sec</em>)</td>
      <td>Fast (<em>105 932 203 ops/sec</em>), but slower than Datastream</td>
    </tr>
    <tr>
      <td><strong>Programming model:</strong></td>
      <td>More complicated</td>
      <td>Simple and convenient</td>
    </tr>
  </tbody>
</table>

<p>To provide maximum efficiency, ActiveJ widely utilizes combinations of CSP and Datastream. For this purpose, 
<strong>ChannelSupplier</strong>, <strong>ChannelConsumer</strong>, <a href="https://github.com/activej/activej/blob/v4.3/core-datastream/src/main/java/io/activej/datastream/StreamSupplier.java"><strong>StreamSupplier</strong></a> 
and <a href="https://github.com/activej/activej/blob/v4.3/core-datastream/src/main/java/io/activej/datastream/StreamConsumer.java"><strong>StreamConsumer</strong></a> have <em>transformWith()</em> methods and special 
Transformer interfaces. Using them, you can seamlessly transform channels into other channels or datastreams and vice 
versa, creating chains of such transformations.</p>

<h2 id="benchmark">Benchmark</h2>
<p>We’ve measured CSP performance (<strong>ChannelSupplier</strong> streams 50M <strong>Integer</strong> objects to <strong>ChannelConsumer</strong> scenario) 
and received the following result:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Time: 4720ms<span class="p">;</span> Average <span class="nb">time</span>: 472.0ms<span class="p">;</span> Best <span class="nb">time</span>: 469ms<span class="p">;</span> Worst <span class="nb">time</span>: 475ms<span class="p">;</span> Operations per second: 105 932 203 </code></pre></figure>

<p>We’ve also measured TCP server performance that uses both CSP and Datastream and got the average result of <strong>47 495 905 requests per second</strong>.</p>

<h2 id="examples">Examples</h2>
<ul>
  <li><a href="#basic-channel-example">Basic Channel Example</a></li>
  <li><a href="#csp-example">CSP Example</a></li>
  <li><a href="#channel-buffer-example">Channel Buffer Example</a></li>
  <li><a href="#channelsplitter-example">ChannelSplitter Example</a></li>
  <li><a href="#bytebufs-decoder-example">ByteBufsDecoderExample</a></li>
  <li><a href="#channel-file-example">Channel File Example</a></li>
</ul>

<div class="note-wrapper">
    <div class="note">
        <b>Note:</b>
        To run the examples, you need to clone ActiveJ from GitHub: 
<br /> <b>$ git clone https://github.com/activej/activej</b> 
<br /> And import it as a Maven project. Check out tag <b>v4.3</b>. Before running the examples, build the project.
<br /> These examples are located at <b>activej -&gt; examples -&gt; core -&gt; csp.</b>
    </div>
</div>

<h3 id="basic-channel-example">Basic Channel Example</h3>
<p><strong>Channel Example</strong> shows the interaction between suppliers and consumers using <em>streamTo</em> and some helper methods:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">supplierOfValues</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="s">"2"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">)</span>
			<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">supplierOfList</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">ofList</span><span class="o">(</span><span class="n">list</span><span class="o">)</span>
			<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">map</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
			<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">integer</span> <span class="o">-&gt;</span> <span class="n">integer</span> <span class="o">+</span> <span class="s">" times 10 = "</span> <span class="o">+</span> <span class="n">integer</span> <span class="o">*</span> <span class="mi">10</span><span class="o">)</span>
			<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">toCollector</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
			<span class="o">.</span><span class="na">toCollector</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">())</span>
			<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">filter</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>
			<span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">integer</span> <span class="o">-&gt;</span> <span class="n">integer</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
			<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure>

<p>Thus, if you run this example, you’ll receive the following output:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">1
2
3
4
5
One
Two
Three
1 <span class="nb">times </span>10 <span class="o">=</span> 10
2 <span class="nb">times </span>10 <span class="o">=</span> 20
3 <span class="nb">times </span>10 <span class="o">=</span> 30
4 <span class="nb">times </span>10 <span class="o">=</span> 40
5 <span class="nb">times </span>10 <span class="o">=</span> 50
<span class="o">[</span>1, 2, 3, 4, 5]
2
4
6</code></pre></figure>

<h5 id="see-full-example-on-github"><a href="https://github.com/activej/activej/blob/v4.3/examples/core/csp/src/main/java/ChannelExample.java">See full example on GitHub</a></h5>

<h3 id="csp-example">CSP Example</h3>
<p>This example represents an <a href="https://github.com/activej/activej/blob/v4.3/core-promise/src/main/java/io/activej/async/process/AsyncProcess.java"><strong>AsyncProcess</strong></a> 
between <strong>ChannelSupplier</strong> and <strong>ChannelConsumer</strong>. In this example 
<strong>ChannelSupplier</strong> represents an input and <strong>ChannelConsumer</strong> - output:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CspExample</span> <span class="kd">extends</span> <span class="nc">AbstractCommunicatingProcess</span> <span class="kd">implements</span> <span class="nc">WithChannelTransformer</span><span class="o">&lt;</span><span class="nc">CspExample</span><span class="o">,</span> <span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">ChannelSupplier</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">input</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">ChannelConsumer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">output</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ChannelOutput</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getOutput</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">output</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">output</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">startProcess</span><span class="o">();</span>
		<span class="o">};</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ChannelInput</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getInput</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">input</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="n">input</span><span class="o">;</span>
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">output</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">startProcess</span><span class="o">();</span>
			<span class="k">return</span> <span class="nf">getProcessCompletion</span><span class="o">();</span>
		<span class="o">};</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="c1">//[START REGION_1]</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doProcess</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">input</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
				<span class="o">.</span><span class="na">whenComplete</span><span class="o">((</span><span class="n">data</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
						<span class="n">output</span><span class="o">.</span><span class="na">acceptEndOfStream</span><span class="o">()</span>
								<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">completeProcess</span><span class="o">);</span>
					<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
						<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">()</span> <span class="o">+</span> <span class="sc">'('</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">+</span> <span class="sc">')'</span><span class="o">;</span>

						<span class="n">output</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
								<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">doProcess</span><span class="o">);</span>
					<span class="o">}</span>
				<span class="o">});</span>
	<span class="o">}</span>
	<span class="c1">//[END REGION_1]</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doClose</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Process has been closed with exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
		<span class="n">input</span><span class="o">.</span><span class="na">closeEx</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="n">output</span><span class="o">.</span><span class="na">closeEx</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">withCurrentThread</span><span class="o">();</span>

		<span class="nc">CspExample</span> <span class="n">process</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CspExample</span><span class="o">();</span>
		<span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"hello"</span><span class="o">,</span> <span class="s">"world"</span><span class="o">,</span> <span class="s">"nice"</span><span class="o">,</span> <span class="s">"to"</span><span class="o">,</span> <span class="s">"see"</span><span class="o">,</span> <span class="s">"you"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">transformWith</span><span class="o">(</span><span class="n">process</span><span class="o">)</span>
				<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span>

		<span class="n">eventloop</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>This process takes a string, sets it to upper-case and adds string’s length in parentheses:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">HELLO<span class="o">(</span>5<span class="o">)</span>
WORLD<span class="o">(</span>5<span class="o">)</span>
NICE<span class="o">(</span>4<span class="o">)</span>
TO<span class="o">(</span>2<span class="o">)</span>
SEE<span class="o">(</span>3<span class="o">)</span>
YOU<span class="o">(</span>3<span class="o">)</span></code></pre></figure>

<h5 id="see-this-example-on-github"><a href="https://github.com/activej/activej/blob/v4.3/examples/core/csp/src/main/java/CspExample.java">See this example on GitHub</a></h5>

<h3 id="channel-buffer-example">Channel Buffer Example</h3>
<p>As it was mentioned <a href="#channel-queue">before</a>, there are two <strong>ChannelQueue</strong> implementations: <strong>ChannelBuffer</strong> and <strong>ChannelZeroBuffer</strong>, 
both of them manage communication between Providers and Suppliers. 
You can manually set the size of <strong>ChannelBuffer</strong>, whereas <strong>ChannelZeroBuffer</strong> size is always 0.</p>

<p>To understand how all these Buffers work, let’s have a simple example. Assume there is a <strong>Granny</strong> 
who wants to give her <strong>Grandson</strong> 25 <strong>Apple</strong>s. That’s quite a lot, so she first puts the <strong>Apple</strong>s on a big <strong>Plate</strong>, 
which can place up to 10 apples simultaneously. When the <strong>Plate</strong> is full, <strong>Grandson</strong> should first take at least one apple, 
and only after that <strong>Granny</strong> can put a new <strong>Apple</strong> to the <strong>Plate</strong>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ChannelBufferStream</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">withCurrentThread</span><span class="o">();</span>

		<span class="nc">ChannelBuffer</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">plate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChannelBuffer</span><span class="o">&lt;&gt;(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
		<span class="nc">ChannelSupplier</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">granny</span> <span class="o">=</span> <span class="n">plate</span><span class="o">.</span><span class="na">getSupplier</span><span class="o">();</span>
		<span class="nc">Promises</span><span class="o">.</span><span class="na">loop</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span>
				<span class="n">apple</span> <span class="o">-&gt;</span> <span class="n">apple</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="o">,</span>
				<span class="n">apple</span> <span class="o">-&gt;</span> <span class="n">plate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">apple</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="err">$</span> <span class="o">-&gt;</span> <span class="o">{</span>
					<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Granny gives apple   #"</span> <span class="o">+</span> <span class="n">apple</span><span class="o">);</span>
					<span class="k">return</span> <span class="n">apple</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
				<span class="o">}));</span>
		<span class="n">granny</span><span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="n">apple</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Grandson takes apple #"</span> <span class="o">+</span> <span class="n">apple</span><span class="o">)));</span>
		<span class="n">eventloop</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>On the next day <strong>Granny</strong> wants to give <strong>Apple</strong>s to her <strong>Grandson</strong> again, but this time there are only 10 
<strong>Apples</strong>. So there is no real need of the plate: <strong>Granny</strong> can simply pass the <strong>Apples</strong> to her <strong>Grandson</strong> 
one by one:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ChannelBufferZeroExample</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">withCurrentThread</span><span class="o">();</span>

		<span class="nc">ChannelQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChannelZeroBuffer</span><span class="o">&lt;&gt;();</span>
		<span class="nc">ChannelSupplier</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">granny</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">getSupplier</span><span class="o">();</span>

		<span class="nc">Promises</span><span class="o">.</span><span class="na">loop</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span>
				<span class="n">apple</span> <span class="o">-&gt;</span> <span class="n">apple</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">,</span>
				<span class="n">apple</span> <span class="o">-&gt;</span> <span class="n">buffer</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">apple</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="err">$</span> <span class="o">-&gt;</span> <span class="o">{</span>
					<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Granny gives apple   #"</span> <span class="o">+</span> <span class="n">apple</span><span class="o">);</span>
					<span class="k">return</span> <span class="n">apple</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
				<span class="o">}));</span>

		<span class="n">granny</span><span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span><span class="n">ofConsumer</span><span class="o">((</span><span class="n">apple</span><span class="o">)</span> <span class="o">-&gt;</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Grandson takes apple #"</span> <span class="o">+</span> <span class="n">apple</span><span class="o">)).</span><span class="na">async</span><span class="o">());</span>

		<span class="n">eventloop</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h5 id="see-full-example-on-github-1"><a href="https://github.com/activej/activej/blob/v4.3/examples/core/csp/src/main/java/ChannelBufferExample.java">See full example on GitHub</a></h5>
<p><br /></p>

<h3 id="channelsplitter-example">ChannelSplitter Example</h3>
<p>In this example we use predefined <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/process/ChannelSplitter.java"><strong>ChannelSplitter</strong></a>. 
Splitter allows to split data from one input to several outputs. In our case output will be split into three 
<strong>ChannelConsumers</strong>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SplitterExample</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">withCurrentThread</span><span class="o">();</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
				<span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
				<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

		<span class="nc">ChannelSplitter</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">splitter</span> <span class="o">=</span> <span class="nc">ChannelSplitter</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">ofList</span><span class="o">(</span><span class="n">integers</span><span class="o">));</span>

		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

		<span class="n">splitter</span><span class="o">.</span><span class="na">addOutput</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">AsyncConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nl">list1:</span><span class="o">:</span><span class="n">add</span><span class="o">)));</span>
		<span class="n">splitter</span><span class="o">.</span><span class="na">addOutput</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">AsyncConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nl">list2:</span><span class="o">:</span><span class="n">add</span><span class="o">)));</span>
		<span class="n">splitter</span><span class="o">.</span><span class="na">addOutput</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">AsyncConsumer</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nl">list3:</span><span class="o">:</span><span class="n">add</span><span class="o">)));</span>

		<span class="n">eventloop</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First list: "</span> <span class="o">+</span> <span class="n">list1</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Second list: "</span> <span class="o">+</span> <span class="n">list2</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Third list: "</span> <span class="o">+</span> <span class="n">list3</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h5 id="see-full-example-on-github-2"><a href="https://github.com/activej/activej/blob/v4.3/examples/core/csp/src/main/java/SplitterExample.java">See full example on GitHub</a></h5>

<h3 id="bytebufs-decoder-example">ByteBufs Decoder Example</h3>
<p><a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/binary/ByteBufsDecoder.java"><strong>ByteBufsDecoder</strong></a> 
allows to efficiently work with <a href="bytebuf.html">ByteBufs</a> and decode data stored in them for further processing. In 
this example <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/binary/BinaryChannelSupplier.java"><strong>BinaryChannelSupplier</strong></a> 
will supply a String decoded and parsed from a ByteBuf.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"Convert2MethodRef"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ByteBufsDecoderExample</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">withCurrentThread</span><span class="o">();</span>

		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">ByteBuf</span><span class="o">&gt;</span> <span class="n">letters</span> <span class="o">=</span> <span class="n">asList</span><span class="o">(</span><span class="n">wrapAscii</span><span class="o">(</span><span class="s">"H"</span><span class="o">),</span> <span class="n">wrapAscii</span><span class="o">(</span><span class="s">"e"</span><span class="o">),</span> <span class="n">wrapAscii</span><span class="o">(</span><span class="s">"l"</span><span class="o">),</span> <span class="n">wrapAscii</span><span class="o">(</span><span class="s">"l"</span><span class="o">),</span> <span class="n">wrapAscii</span><span class="o">(</span><span class="s">"o"</span><span class="o">));</span>
		<span class="nc">ByteBufsDecoder</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">bufs</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">bufs</span><span class="o">.</span><span class="na">hasRemainingBytes</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span> <span class="o">{</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Not enough bytes to decode message"</span><span class="o">);</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">bufs</span><span class="o">.</span><span class="na">takeExactSize</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="na">asString</span><span class="o">(</span><span class="no">UTF_8</span><span class="o">);</span>
		<span class="o">};</span>

		<span class="nc">BinaryChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">ofList</span><span class="o">(</span><span class="n">letters</span><span class="o">)).</span><span class="na">decode</span><span class="o">(</span><span class="n">decoder</span><span class="o">)</span>
				<span class="o">.</span><span class="na">whenResult</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">));</span>

		<span class="n">eventloop</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="channel-file-example">Channel File Example</h3>
<p>This example demonstrates how to work with files asynchronously using Promises and CSP built-in 
consumers and suppliers. This example writes two lines to the file with <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/file/ChannelFileWriter.java"><strong>ChannelFileWriter</strong></a>, then reads and prints 
them out utilizing <a href="https://github.com/activej/activej/blob/v4.3/core-csp/src/main/java/io/activej/csp/file/ChannelFileReader.java"><strong>ChannelFileReader</strong></a>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@NotNull</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Promise</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">writeToFile</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="nc">ChannelSupplier</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
			<span class="nc">ByteBufStrings</span><span class="o">.</span><span class="na">wrapAscii</span><span class="o">(</span><span class="s">"Hello, this is example file\n"</span><span class="o">),</span>
			<span class="nc">ByteBufStrings</span><span class="o">.</span><span class="na">wrapAscii</span><span class="o">(</span><span class="s">"This is the second line of file\n"</span><span class="o">))</span>
			<span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelFileWriter</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">executor</span><span class="o">,</span> <span class="no">PATH</span><span class="o">,</span> <span class="no">WRITE</span><span class="o">));</span>
<span class="o">}</span>

<span class="nd">@NotNull</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Promise</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">readFile</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="nc">ChannelFileReader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">executor</span><span class="o">,</span> <span class="no">PATH</span><span class="o">)</span>
			<span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">cfr</span> <span class="o">-&gt;</span> <span class="n">cfr</span><span class="o">.</span><span class="na">streamTo</span><span class="o">(</span><span class="nc">ChannelConsumer</span><span class="o">.</span><span class="na">ofConsumer</span><span class="o">(</span><span class="n">buf</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">buf</span><span class="o">.</span><span class="na">asString</span><span class="o">(</span><span class="no">UTF_8</span><span class="o">)))));</span>

<span class="o">}</span></code></pre></figure>

<p>If you run the example, you’ll see the content of the created file:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Hello, this is example file
This is the second line of file</code></pre></figure>

<h5 id="see-full-example-on-github-3"><a href="https://github.com/activej/activej/blob/v4.3/examples/core/csp/src/main/java/ChannelFileExample.java">See full example on GitHub</a></h5>

    <div class="row docs-prevnext">
        
            <div class="col-sm-6">
                <a class="docs-prevnext__button pull-left" href="promise.html">Prev</a>
            </div>
        
        
            <div class="col-sm-6">
                <a class="docs-prevnext__button pull-right" href="datastream.html">Next</a>
            </div>
        
    </div>
</div>


                </div>
            </div>
        
        <div class="container justify-content-between footer">
            <div class="col-md-4 col-lg-5"> &copy; 2021 ActiveJ LLC. All Rights Reserved</div>
            <div class="col-md-4 col-lg-3">Contact us: contact@activej.io</div>
            <div class="col-md-8 col-lg-4 footer__menu">
                <a href="http://uikernel.io">UIKernel</a>
                <a href="https://adkernel.com">AdKernel</a>
                <a href="https://github.com/activej/activej">GitHub</a>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src="../static/js/leon.js"></script>
    <script src="../static/js/index.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous">
    </script>
</body>
</html>
