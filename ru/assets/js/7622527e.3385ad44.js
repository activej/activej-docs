(self.webpackChunkactivejdocs=self.webpackChunkactivejdocs||[]).push([[5224],{3149:function(e,n,t){"use strict";var a=t(67294),o=t(39962),i=t(41106),r=t.n(i),s=t(15835);t.n(s)().interpolate=/{{([\s\S]+?)}}/g,n.Z=function(e){var n=e.href,t=e.children,i=e.target,s=void 0===i?"_blank":i,c=(0,o.Z)().siteConfig,p=r()(n);return a.createElement("a",{href:p(c.customFields),target:s},t)}},77618:function(e,n,t){"use strict";var a=t(67294),o=t(39962);n.Z=function(e){var n=e.url,t=e.text,i=e.isInline,r=void 0===i||i,s=e.children,c=(0,o.Z)().siteConfig,p=n.startsWith("/examples")?c.customFields.githubExamplesBranch:c.customFields.githubBranch;return a.createElement("a",{style:r?{}:{display:"block",marginBottom:"16px"},href:c.customFields.githubUrl+"/"+p+n,target:"_blank"},t||s)}},9900:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return d},default:function(){return h}});var a=t(87462),o=t(63366),i=(t(67294),t(3905)),r=t(77618),s=t(3149),c=["components"],p={sidebar_label:"Scopes"},l="Scopes",u={unversionedId:"inject/scopes",id:"inject/scopes",isDocsHomePage:!1,title:"Scopes",description:"A Scope in ActiveJ Inject allows you to reuse instances. A scoped instances are independent of instances in other scopes.",source:"@site/docs/inject/scopes.mdx",sourceDirName:"inject",slug:"/inject/scopes",permalink:"/ru/inject/scopes",tags:[],version:"current",frontMatter:{sidebar_label:"Scopes"},sidebar:"docs",previous:{title:"Optional dependencies",permalink:"/ru/inject/optional-dependencies"},next:{title:"Transient bindings",permalink:"/ru/inject/transient-bindings"}},d=[{value:"Defining scopes",id:"defining-scopes",children:[]},{value:"Entering a scope",id:"entering-a-scope",children:[]}],m={toc:d};function h(e){var n=e.components,t=(0,o.Z)(e,c);return(0,i.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"scopes"},"Scopes"),(0,i.kt)("p",null,"A Scope in ActiveJ Inject allows you to reuse instances. A scoped instances are independent of instances in other scopes.\nBy default, each instance obtained from an ",(0,i.kt)("inlineCode",{parentName:"p"},"Injector")," is singleton. That means it is cached and when you try to retrieve\nan instance of the same type once again, a cached instance is returned. But, there are situations when you need to recreate\nsome instances as they are tied to some semantic scope (application scope, request scope, process scope)."),(0,i.kt)("p",null,"For example, we can have a dedicated HTTP scope. Each request will be bound to the HTTP scope and every instance created\nwithin this scope is valid only during a lifetime of an HTTP request (time between receiving an HTTP request and returning\nan HTTP response)."),(0,i.kt)("p",null,"An ",(0,i.kt)("inlineCode",{parentName:"p"},"Injector"),' may "enter" the scope. That means a new scoped ',(0,i.kt)("inlineCode",{parentName:"p"},"Injector"),' will be created out of the main one.\nThis "scoped" injector will have a link to the parent injector, so in case it cannot obtain some instance from within its\nown scope it will fall back to the parent injector.'),(0,i.kt)("p",null,"Scopes can be nested. You can have a scope inside another scope and so on. When you try to get an instance from a nested\nscope injector, what happens is the innermost injector gets queried first. If it cannot return an instance, the next upper scope\ninjector will be queried and so on until we can return an instance."),(0,i.kt)("h2",{id:"defining-scopes"},"Defining scopes"),(0,i.kt)("p",null,"A scope is represented using a special scope annotation. A scope annotation is a marker annotation\n(meaning it has no members or data) that is itself annotated with a special marker annotation ",(0,i.kt)(r.Z,{text:"@ScopeAnnotation",url:"/core-inject/src/main/java/io/activej/inject/ScopeAnnotation",mdxType:"Githublink"}),"."),(0,i.kt)("p",null,"Here is how we can have define an annotation for HTTP scope:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"@ScopeAnnotation\n@Target(ElementType.METHOD)\n@Retention(RUNTIME)\npublic @interface HttpScope {\n}\n")),(0,i.kt)("p",null,"We can then define a binding within the HTTP scope using ",(0,i.kt)(r.Z,{text:"ModuleBuilder",url:"/core-inject/src/main/java/io/activej/inject/module/ModuleBuilder",mdxType:"Githublink"})," DSL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"bind(Integer.class).toInstance(123).in(HttpScope.class)\n")),(0,i.kt)("p",null,"Another way to define a scoped binding is to use scope annotation with ",(0,i.kt)("inlineCode",{parentName:"p"},"@Provides")," annotated methods like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"@Provides\n@HttpScope\nInteger integer() {\n    return 123;\n}\n")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"We have annotated scope annotation with ",(0,i.kt)("inlineCode",{parentName:"p"},"@Retention(RUNTIME)")," annotation as scopes are processed at the runtime."),(0,i.kt)("p",{parentName:"div"},(0,i.kt)("inlineCode",{parentName:"p"},"@Target(ElementType.METHOD)")," annotation is present because we use scope annotations on methods."))),(0,i.kt)("h2",{id:"entering-a-scope"},"Entering a scope"),(0,i.kt)("p",null,"To enter a certain scope we use ",(0,i.kt)("inlineCode",{parentName:"p"},"Injector#enterScope(Scope)"),' method that returns a "scoped" injector.'),(0,i.kt)("p",null,"For example, let's enter the HTTP scope defined previously:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Injector scopedInjector = injector.enterScope(Scope.of(HttpScope.class));\n")),(0,i.kt)("p",null,"Now we can use ",(0,i.kt)("inlineCode",{parentName:"p"},"scopedInjector")," to retrieve instances from within HTTP scope."),(0,i.kt)("p",null,"You can find a full example of HTTP scope on ",(0,i.kt)(s.Z,{href:"https://github.com/activej/activej/{{githubExamplesBranch}}/examples/core/inject/src/main/java/ScopeExample.java",mdxType:"DynamicLink"},"Github")))}h.isMDXComponent=!0},18674:function(e){e.exports=function(e){return function(n){return null==e?void 0:e[n]}}},24626:function(e,n,t){var a=t(77813),o=Object.prototype,i=o.hasOwnProperty;e.exports=function(e,n,t,r){return void 0===e||a(e,o[t])&&!i.call(r,t)?n:e}},89464:function(e,n,t){var a=t(18674)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=a},31994:function(e){var n={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};e.exports=function(e){return"\\"+n[e]}},79865:function(e){e.exports=/<%-([\s\S]+?)%>/g},76051:function(e){e.exports=/<%([\s\S]+?)%>/g},5712:function(e){e.exports=/<%=([\s\S]+?)%>/g},29018:function(e,n,t){var a=t(98363),o=t(21463),i=t(81704),r=o((function(e,n,t,o){a(n,i(n),e,o)}));e.exports=r},9591:function(e,n,t){var a=t(96874),o=t(5976),i=t(64647),r=o((function(e,n){try{return a(e,void 0,n)}catch(t){return i(t)?t:new Error(t)}}));e.exports=r},7187:function(e,n,t){var a=t(89464),o=t(79833),i=/[&<>"']/g,r=RegExp(i.source);e.exports=function(e){return(e=o(e))&&r.test(e)?e.replace(i,a):e}},64647:function(e,n,t){var a=t(44239),o=t(37005),i=t(68630);e.exports=function(e){if(!o(e))return!1;var n=a(e);return"[object Error]"==n||"[object DOMException]"==n||"string"==typeof e.message&&"string"==typeof e.name&&!i(e)}},41106:function(e,n,t){var a=t(29018),o=t(9591),i=t(47415),r=t(24626),s=t(31994),c=t(64647),p=t(16612),l=t(3674),u=t(5712),d=t(15835),m=t(79833),h=/\b__p \+= '';/g,v=/\b(__p \+=) '' \+/g,f=/(__e\(.*?\)|\b__t\)) \+\n'';/g,g=/[()=,{}\[\]\/\s]/,k=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,j=/($^)/,b=/['\n\r\u2028\u2029\\]/g,w=Object.prototype.hasOwnProperty;e.exports=function(e,n,t){var _=d.imports._.templateSettings||d;t&&p(e,n,t)&&(n=void 0),e=m(e),n=a({},n,_,r);var T,x,y=a({},n.imports,_.imports,r),N=l(y),S=i(y,N),E=0,H=n.interpolate||j,I="__p += '",M=RegExp((n.escape||j).source+"|"+H.source+"|"+(H===u?k:j).source+"|"+(n.evaluate||j).source+"|$","g"),P=w.call(n,"sourceURL")?"//# sourceURL="+(n.sourceURL+"").replace(/\s/g," ")+"\n":"";e.replace(M,(function(n,t,a,o,i,r){return a||(a=o),I+=e.slice(E,r).replace(b,s),t&&(T=!0,I+="' +\n__e("+t+") +\n'"),i&&(x=!0,I+="';\n"+i+";\n__p += '"),a&&(I+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),E=r+n.length,n})),I+="';\n";var A=w.call(n,"variable")&&n.variable;if(A){if(g.test(A))throw new Error("Invalid `variable` option passed into `_.template`")}else I="with (obj) {\n"+I+"\n}\n";I=(x?I.replace(h,""):I).replace(v,"$1").replace(f,"$1;"),I="function("+(A||"obj")+") {\n"+(A?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(T?", __e = _.escape":"")+(x?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+I+"return __p\n}";var C=o((function(){return Function(N,P+"return "+I).apply(void 0,S)}));if(C.source=I,c(C))throw C;return C}},15835:function(e,n,t){var a=t(7187),o={escape:t(79865),evaluate:t(76051),interpolate:t(5712),variable:"",imports:{_:{escape:a}}};e.exports=o}}]);