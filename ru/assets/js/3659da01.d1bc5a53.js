(self.webpackChunkactivejdocs=self.webpackChunkactivejdocs||[]).push([[5727],{3149:function(n,e,t){"use strict";var a=t(67294),i=t(39962),r=t(41106),s=t.n(r),o=t(15835);t.n(o)().interpolate=/{{([\s\S]+?)}}/g,e.Z=function(n){var e=n.href,t=n.children,r=n.target,o=void 0===r?"_blank":r,c=(0,i.Z)().siteConfig,l=s()(e);return a.createElement("a",{href:l(c.customFields),target:o},t)}},77618:function(n,e,t){"use strict";var a=t(67294),i=t(39962);e.Z=function(n){var e=n.url,t=n.text,r=n.isInline,s=void 0===r||r,o=n.children,c=(0,i.Z)().siteConfig,l=e.startsWith("/examples")?c.customFields.githubExamplesBranch:c.customFields.githubBranch;return a.createElement("a",{style:s?{}:{display:"block",marginBottom:"16px"},href:c.customFields.githubUrl+"/"+l+e,target:"_blank"},t||o)}},44697:function(n,e,t){"use strict";t.r(e),t.d(e,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return p},toc:function(){return d},default:function(){return g}});var a=t(83117),i=t(80102),r=(t(67294),t(3905)),s=t(77618),o=t(3149),c=["components"],l={sidebar_label:"Transient bindings"},u="Transient bindings",p={unversionedId:"inject/transient-bindings",id:"inject/transient-bindings",isDocsHomePage:!1,title:"Transient bindings",description:"By default every instance obtained using ActiveJ Inject is singleton. This means that instances are cached when retrieved",source:"@site/docs/inject/transient-bindings.mdx",sourceDirName:"inject",slug:"/inject/transient-bindings",permalink:"/ru/inject/transient-bindings",tags:[],version:"current",frontMatter:{sidebar_label:"Transient bindings"},sidebar:"docs",previous:{title:"Scopes",permalink:"/ru/inject/scopes"},next:{title:"Speeding up dependency injection",permalink:"/ru/inject/speeding-up-injection"}},d=[{value:"Defining transient bindings",id:"defining-transient-bindings",children:[],level:2},{value:"Transient binding example",id:"transient-binding-example",children:[],level:2}],m={toc:d};function g(n){var e=n.components,t=(0,i.Z)(n,c);return(0,r.kt)("wrapper",(0,a.Z)({},m,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"transient-bindings"},"Transient bindings"),(0,r.kt)("p",null,"By default every instance obtained using ActiveJ Inject is singleton. This means that instances are cached when retrieved\nthe first time and then reused on future ",(0,r.kt)("inlineCode",{parentName:"p"},"Injector#getInstance")," calls. This behavior is different from a default\nbehaviour of a majority of other dependency injection frameworks."),(0,r.kt)("p",null,'However, there are situations when you do not want to cache an instance, but rather you want to create a new instance each time.\nFor that you can use "transient" binding. Such bindings are special because instances retrieved using "transient" bindings\nare not cached. Such instances are recreated each time when being retrieved.'),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Transient bindings are not transitive. If you have a non-transient binding ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," that depends on an instance\nprovided via a transient binding ",(0,r.kt)("inlineCode",{parentName:"p"},"B"),", a binding ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," is not itself transient. It will use a cached instance of a transient\nbinding."))),(0,r.kt)("h2",{id:"defining-transient-bindings"},"Defining transient bindings"),(0,r.kt)("p",null,"There are multiple ways to define a transient binding."),(0,r.kt)("p",null,"We can use ",(0,r.kt)("inlineCode",{parentName:"p"},"asTransient()")," method from the ",(0,r.kt)(s.Z,{text:"ModuleBuilder",url:"/core-inject/src/main/java/io/activej/inject/module/ModuleBuilder",mdxType:"Githublink"})," DSL\nand mark a binding as transient like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"bind(double.class).to(Math::random).asTransient();\n")),(0,r.kt)("p",null,"Or, alternatively we can use ",(0,r.kt)("inlineCode",{parentName:"p"},"@Transient")," annotation to annotate methods already annotated with ",(0,r.kt)("inlineCode",{parentName:"p"},"@Provides")," annotation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"@Provides\ndouble random() {\n    return Math.random();\n}\n")),(0,r.kt)("p",null,"When you retrieve an instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"double")," from the injector you will get a new random number each time."),(0,r.kt)("h2",{id:"transient-binding-example"},"Transient binding example"),(0,r.kt)("p",null,"Let's look at another example. Imagine that our application needs to know a current time. Therefore, we cannot cache an\ninstance of an ",(0,r.kt)("inlineCode",{parentName:"p"},"Instant"),". So, we should create a binding for an ",(0,r.kt)("inlineCode",{parentName:"p"},"Instant")," as transient."),(0,r.kt)("p",null,"Let's define a module that defines a binding for an instance of current ",(0,r.kt)("inlineCode",{parentName:"p"},"Instant")," (notice the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Transient")," annotation):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:"url=/examples/core/inject/src/main/java/TransientBindingExample.java tag=MODULE",url:"/examples/core/inject/src/main/java/TransientBindingExample.java",tag:"MODULE"},"static class CurrentTimeModule extends AbstractModule {\n  @Provides\n  @Transient\n  Instant currentInstant() {\n    return Instant.now();\n  }\n}\n")),(0,r.kt)("p",null,"Now let's retrieve two instances of an ",(0,r.kt)("inlineCode",{parentName:"p"},"Instant")," from the injector waiting for a second between each retrieval:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:"url=/examples/core/inject/src/main/java/TransientBindingExample.java tag=INJECTOR",url:"/examples/core/inject/src/main/java/TransientBindingExample.java",tag:"INJECTOR"},"Injector injector = Injector.of(new CurrentTimeModule());\n\nSystem.out.println(injector.getInstance(Instant.class));\nThread.sleep(1000);\nSystem.out.println(injector.getInstance(Instant.class));\n")),(0,r.kt)("p",null,"If we run the example we will see that retrieved instances of ",(0,r.kt)("inlineCode",{parentName:"p"},"Instant")," differ by approximately 1 second."),(0,r.kt)("p",null,"You can find a full example on ",(0,r.kt)(o.Z,{href:"https://github.com/activej/activej/{{githubExamplesBranch}}/examples/core/inject/src/main/java/TransientBindingExample.java",mdxType:"DynamicLink"},"Github")))}g.isMDXComponent=!0},18674:function(n){n.exports=function(n){return function(e){return null==n?void 0:n[e]}}},24626:function(n,e,t){var a=t(77813),i=Object.prototype,r=i.hasOwnProperty;n.exports=function(n,e,t,s){return void 0===n||a(n,i[t])&&!r.call(s,t)?e:n}},89464:function(n,e,t){var a=t(18674)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});n.exports=a},31994:function(n){var e={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};n.exports=function(n){return"\\"+e[n]}},79865:function(n){n.exports=/<%-([\s\S]+?)%>/g},76051:function(n){n.exports=/<%([\s\S]+?)%>/g},5712:function(n){n.exports=/<%=([\s\S]+?)%>/g},29018:function(n,e,t){var a=t(98363),i=t(21463),r=t(81704),s=i((function(n,e,t,i){a(e,r(e),n,i)}));n.exports=s},9591:function(n,e,t){var a=t(96874),i=t(5976),r=t(64647),s=i((function(n,e){try{return a(n,void 0,e)}catch(t){return r(t)?t:new Error(t)}}));n.exports=s},7187:function(n,e,t){var a=t(89464),i=t(79833),r=/[&<>"']/g,s=RegExp(r.source);n.exports=function(n){return(n=i(n))&&s.test(n)?n.replace(r,a):n}},64647:function(n,e,t){var a=t(44239),i=t(37005),r=t(68630);n.exports=function(n){if(!i(n))return!1;var e=a(n);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof n.message&&"string"==typeof n.name&&!r(n)}},41106:function(n,e,t){var a=t(29018),i=t(9591),r=t(47415),s=t(24626),o=t(31994),c=t(64647),l=t(16612),u=t(3674),p=t(5712),d=t(15835),m=t(79833),g=/\b__p \+= '';/g,v=/\b(__p \+=) '' \+/g,f=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/[()=,{}\[\]\/\s]/,b=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,k=/($^)/,j=/['\n\r\u2028\u2029\\]/g,x=Object.prototype.hasOwnProperty;n.exports=function(n,e,t){var w=d.imports._.templateSettings||d;t&&l(n,e,t)&&(e=void 0),n=m(n),e=a({},e,w,s);var _,y,N=a({},e.imports,w.imports,s),T=u(N),I=r(N,T),C=0,E=e.interpolate||k,M="__p += '",B=RegExp((e.escape||k).source+"|"+E.source+"|"+(E===p?b:k).source+"|"+(e.evaluate||k).source+"|$","g"),S=x.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";n.replace(B,(function(e,t,a,i,r,s){return a||(a=i),M+=n.slice(C,s).replace(j,o),t&&(_=!0,M+="' +\n__e("+t+") +\n'"),r&&(y=!0,M+="';\n"+r+";\n__p += '"),a&&(M+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),C=s+e.length,e})),M+="';\n";var D=x.call(e,"variable")&&e.variable;if(D){if(h.test(D))throw new Error("Invalid `variable` option passed into `_.template`")}else M="with (obj) {\n"+M+"\n}\n";M=(y?M.replace(g,""):M).replace(v,"$1").replace(f,"$1;"),M="function("+(D||"obj")+") {\n"+(D?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(_?", __e = _.escape":"")+(y?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+M+"return __p\n}";var L=i((function(){return Function(T,S+"return "+M).apply(void 0,I)}));if(L.source=M,c(L))throw L;return L}},15835:function(n,e,t){var a=t(7187),i={escape:t(79865),evaluate:t(76051),interpolate:t(5712),variable:"",imports:{_:{escape:a}}};n.exports=i}}]);