<!DOCTYPE html>
<html lang="en">
<head>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
    <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176574648-1');
    </script>
    
    <link rel='stylesheet' href='/static/css/pygment_trac.css'/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <title>ActiveJ | Workers, overcome the complexities and overheads of multithreaded programming model</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content=" ActiveJ Workers allow to overcome the complexities and overheads of multithreaded programming model yet preserve Java multithreading capabilities ">
    <meta name="keywords" content="  ">
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
    <meta name="og:description" content="ActiveJ is an alternative Java platform built from the ground up as a replacement of Spring, Spark, Quarkus, Micronauts, and other solutions. It is minimalistic, boilerplate-free, and provides outstanding performance." />
    <meta name="og:image" content="https://activej.io/static/images/AJ_Card.jpeg" />
    <meta name="og:title" content="ActiveJ - An Alternative Java platform built for web, high load, and cloud development" />
</head>
<body>
    <div class="navbar-container-wrapper">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
            <ul class="navbar-nav-visible mr-auto mt-1 mt-lg-0">
                <div class="logo-link-title mr-5">
                    <img src="/favicon.png" style="max-width: 25px">
                    
                    
                    <a class="navbar-nav__link logo-link-title" href="/" style="margin-left: 5px">ActiveJ</a>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </div>
            </ul>
            <button class="navbar-toggler m-1 ml-auto" type="button" data-toggle="collapse" data-target="#navbarToggler"
                    aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarToggler">
                <div class="container">
                    
                    
                    <ul class="navbar-nav navbar-nav-visible mr-auto mt-1 mt-lg-0">
                        
                        <li>
                            <a class="navbar-nav__link nav-expanded" href="/tutorials/getting-started.html">
                                Tutorials
                            </a>
                        </li>
                        
                        <li>
                            <a class="navbar-nav__link nav-expanded" href="/http.html">
                                Docs
                            </a>
                        </li>
                        
                    </ul>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </div>
                <span>
              <ul class="navbar-nav expanded-links navbar-nav-visible mr-auto mt-1 mt-lg-0">
                  <li class="dropdown">
                    <a class="nav-link nav-expanded">Components</a>
                    <ul class="dropdown__content">
                        
                            <div class="dropdown__content-wrapper">
                                
                                    <a href="https://activej.io" class="dropdown__content__item  selected-link ">
                                        <li>
                                            <div href="https://activej.io">ActiveJ</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Redefining Java for modern web applications </p>
                                    </a>
                                
                                    <a href="https://inject.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://inject.activej.io">ActiveJ Inject</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Lightning-fast and ultimately powerful DI library </p>
                                    </a>
                                
                                    <a href="https://serializer.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://serializer.activej.io">ActiveJ Serializer</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> The fastest JVM serializer in the world </p>
                                    </a>
                                
                                    <a href="https://codegen.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://codegen.activej.io">ActiveJ Codegen</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Dynamic bytecode generation without overhead of reflection </p>
                                    </a>
                                
                                    <a href="https://specializer.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://specializer.activej.io">ActiveJ Specializer</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> A little bit of magic to speed up your code </p>
                                    </a>
                                
                                    <a href="https://rpc.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://rpc.activej.io">ActiveJ RPC</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Lightning-fast binary protocol for microservices architecture </p>
                                    </a>
                                
                                    <a href="https://fs.activej.io" class="dropdown__content__item ">
                                        <li>
                                            <div href="https://fs.activej.io">ActiveJ FS</div>
                                        </li>
                                        <p class="dropdown__content__item__text"> Tiny abstraction for managing local, remote, and distributed FS </p>
                                    </a>
                                
                           </div>
                        
                    </ul>
                </li>
                  <li><a class="navbar-nav__link" href="https://activej.io/blog/release-notes.html">Blog</a> </li>
                <li><a class="navbar-nav__link" href="http://uikernel.io">UIKernel</a></li>
                <li><a class="navbar-nav__link" href="https://adkernel.com">AdKernel</a></li>
                <li><a class="navbar-nav__link" href="https://github.com/activej/activej">GitHub</a></li>
                <li><a class="navbar-nav__link" href="/about.html">About us</a></li>
              </ul>
            </span>
            </div>
        </nav>
    </div>
</div>

    <div class="content">
        
            <div class="container">
                <div class="row">
                    <div class="px-0 mb-3 sidebar">
    
<h3>Async I/O</h3>
<ul>
    
    
    <li>
        <a href="/http.html">HTTP</a>
    </li>
    
    
    
    <li>
        <a href="/eventloop.html">Eventloop</a>
    </li>
    
    
    
    <li>
        <a href="/promise.html">Promise</a>
    </li>
    
    
    
    <li>
        <a href="/csp.html">CSP</a>
    </li>
    
    
    
    <li>
        <a href="/datastream.html">Datastream</a>
    </li>
    
    
    
    <li>
        <a href="/net.html">Net</a>
    </li>
    
    
    
    <li>
        <a href="/dataflow.html">Dataflow</a>
    </li>
    
    
</ul>

<h3>Boot</h3>
<ul>
    
    
    <li>
        <a href="/launcher.html">Launcher</a>
    </li>
    
    
    
    <li>
        <a href="/service-graph.html">Service Graph</a>
    </li>
    
    
    
    <li class="sidebar-item-selected-wrapper">
        <div class="sidebar-item-selected">
            <a href="/workers.html">Workers</a>
        </div>
    </li>
    
    
    
    <li>
        <a href="/config.html">Config</a>
    </li>
    
    
</ul>

<h3>Misc</h3>
<ul>
    
    
    <li>
        <a href="/bytebuf.html">ByteBuf</a>
    </li>
    
    
    
    <li>
        <a href="/codec.html">Codec</a>
    </li>
    
    
</ul>

</div>
<div class="pr-3 markdown-content docs-content">
    <div class="status-wrapper">
        <h1>Workers </h1>
    </div>
    <h2 id="features">Features</h2>
<p>The primary mission of ActiveJ is to create ultimately fast, scalable, simple to use, and high-abstraction level I/O async 
programming model.
To achieve this, ActiveJ design principles overcome all the performance overhead and complexities of the traditional 
multithreaded programming model, yet fully utilize Java multithreading capabilities. 
ActiveJ offers means of splitting the application into a <code class="language-plaintext highlighter-rouge">Primary Eventloop</code> thread and <code class="language-plaintext highlighter-rouge">Worker 
Eventloop</code> threads. These threads communicate with each other via message passing and thread-safe application-specific 
singleton services.</p>

<p><a href="/eventloop.html">Eventloop</a> thread is essentially a single-threaded mini-application 
(similar to Node.js), which handles its part of I/O tasks and executes Runnables submitted from other threads. 
Primary Eventloop threads distribute and balance I/O tasks between Worker threads.</p>

<figure class="figure-image">
    <img src="/static/images/worker-pool.png" style="max-width: 650px;" />
</figure>

<p>The benefits of ActiveJ threading model:</p>
<ul>
  <li>Each primary/worker Eventloop thread works as a single-threaded application, which is simple to program and to reason about</li>
  <li>There is no multithreaded overhead, races, and thread synchronization overhead</li>
  <li>Traditional strength of Java in multithreaded programming is fully preserved:
    <ul>
      <li>typical I/O load can be easily split between worker threads</li>
      <li>the application can have thread-safe singleton services, which are used by Eventloop threads, and a huge singleton 
  data state, shared among all worker threads</li>
      <li>you can still use some thread synchronization / lock-free algorithms, just try to avoid excessive blocking of 
  concurrent threads</li>
      <li>full interoperability between Java Threads, Thread Pools, Java Futures, and even blocking I/O operations</li>
    </ul>
  </li>
</ul>

<h2 id="worker-scope">Worker Scope</h2>
<h3 id="problem">Problem</h3>
<p>This design raises some implementation questions.
For example, if we want to implement multithreaded HTTP web application with worker eventloops:</p>
<ul>
  <li>according to these design principles, we need to create separate instances of a working eventloop, a single-threaded HTTP 
server, and its servlets for each working thread</li>
  <li>but what if our application has 8 eventloop threads with 10 worker-thread components inside, do we have to create 80 of 
components in total and assign them to each worker thread?</li>
  <li>how is it even possible to manually instantiate, wire, initialize, and start/stop all those components in a 
correct order and also gracefully shutdown application on start/stop errors?</li>
</ul>

<h3 id="solution">Solution</h3>
<p>Luckily, due to <a href="https://inject.activej.io">ActiveJ Inject</a>, we have a solution - <code class="language-plaintext highlighter-rouge">@Worker</code> scope. If you need to implement several worker threads:</p>
<ul>
  <li>include <a href="https://github.com/activej/activej/blob/v4.3/boot-workers/src/main/java/io/activej/worker/WorkerPoolModule.java"><strong>WorkerPoolModule</strong></a> 
module and create a <a href="https://github.com/activej/activej/blob/v4.3/boot-workers/src/main/java/io/activej/worker/WorkerPool.java"><strong>WorkerPool</strong></a> instance</li>
  <li>annotate the components you wish to put into each worker thread with <code class="language-plaintext highlighter-rouge">@Worker</code> scope annotation</li>
</ul>

<p><strong>WorkerPool</strong> will automatically instantiate identical dependency graphs for each of those worker threads
You are by no means limited to the aforementioned scheme with one primary Eventloop and N worker eventloops:</p>
<ul>
  <li>you can still have completely unrelated / standalone eventloops (nor primary, neither worker)</li>
  <li>several primary eventloops sharing the same pool of worker eventloops or several sets of worker pools with different number or threads</li>
  <li>you can even define your own <code class="language-plaintext highlighter-rouge">@Worker</code> annotations, and create multiple worker pools with completely unrelated and 
 different dependency graphs 
All this is in fully transparent and easy-to-understand modules - just mark different components with appropriate 
worker annotations and let <strong>WorkerPool</strong> create all the instances</li>
</ul>

<p>To automatically start/stop application components in correct order, simply include <strong>ServiceGraph</strong> module into your 
<strong>Launcher</strong> - it is aware of worker pools and will treat vectors of worker instances as special compound singleton-like 
instances.</p>

<p>For example, here is an example of utilizing 
<a href="https://github.com/activej/activej/blob/v4.3/launchers/http/src/main/java/io/activej/launchers/http/MultithreadedHttpServerLauncher.java">MultithreadedHttpServerLauncher</a> 
which features <strong>ServiceGraphModule</strong>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MultithreadedHttpServerExample</span> <span class="kd">extends</span> <span class="nc">MultithreadedHttpServerLauncher</span> <span class="o">{</span>
	<span class="nd">@Provides</span>
	<span class="nd">@Worker</span>
	<span class="nc">AsyncServlet</span> <span class="nf">servlet</span><span class="o">(</span><span class="nd">@WorkerId</span> <span class="kt">int</span> <span class="n">workerId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="nc">HttpResponse</span><span class="o">.</span><span class="na">ok200</span><span class="o">()</span>
				<span class="o">.</span><span class="na">withPlainText</span><span class="o">(</span><span class="s">"Hello from worker server #"</span> <span class="o">+</span> <span class="n">workerId</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">MultithreadedHttpServerExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MultithreadedHttpServerExample</span><span class="o">();</span>
		<span class="n">example</span><span class="o">.</span><span class="na">launch</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>And its dependency graph looks as follows:</p>
<figure class="figure-image">
    <img src="/static/images/dependency-graph.png" style="max-width: 800px;" />
</figure>

<p>To help you understand how worker pools work, here is a simplified <strong>WorkerPool</strong> implementation in a nutshell (the actual implementation differs, but not much):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">WorkerPool</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Scope</span> <span class="n">scope</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Injector</span><span class="o">[]</span> <span class="n">scopeInjectors</span><span class="o">;</span>

	<span class="nc">WorkerPool</span><span class="o">(</span><span class="nc">Injector</span> <span class="n">injector</span><span class="o">,</span> <span class="nc">Scope</span> <span class="n">scope</span><span class="o">,</span> <span class="kt">int</span> <span class="n">workers</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">scope</span> <span class="o">=</span> <span class="n">scope</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">scopeInjectors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Injector</span><span class="o">[</span><span class="n">workers</span><span class="o">];</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">workers</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">scopeInjectors</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">enterScope</span><span class="o">(</span><span class="n">scope</span><span class="o">,</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;(),</span> <span class="kc">false</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Instances</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">getInstances</span><span class="o">(</span><span class="nc">Key</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Instances</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Instances</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">scopeInjectors</span><span class="o">.</span><span class="na">length</span><span class="o">]);</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scopeInjectors</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">instances</span><span class="o">.</span><span class="na">instances</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">scopeInjectors</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getInstance</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">instances</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>As you can see, the root <a href="https://github.com/activej/activej/blob/v4.3/core-inject/src/main/java/io/activej/inject/Injector.java"><strong>Injector</strong></a> 
simply ‘enters’ the worker scope <code class="language-plaintext highlighter-rouge">N</code> times, so we have <code class="language-plaintext highlighter-rouge">N</code> <strong>Injector</strong>s with identical bindings/dependency graphs, but 
different containers of instances. Each time we need to create some <em>worker</em> instances, they are created <code class="language-plaintext highlighter-rouge">N</code> times by 
each <em>injector</em> and returned as a vector of <code class="language-plaintext highlighter-rouge">N</code> instances.</p>

<h2 id="examples">Examples</h2>

<div class="note-wrapper">
    <div class="note">
        <b>Note:</b>
        To run the examples, you need to clone ActiveJ from GitHub: 
<br /> <b>$ git clone https://github.com/activej/activej</b> 
<br /> And import it as a Maven project. Check out tag <b>v4.3</b>. Before running the examples, build the project.
<br /> These examples are located at <b>activej -&gt; examples -&gt; core -&gt; boot</b>
    </div>
</div>

<h3 id="basic-worker-pool-example"><strong>Basic Worker Pool Example</strong></h3>
<p>An example of creating a worker pool with 4 workers:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">WorkerPoolModuleExample</span> <span class="kd">extends</span> <span class="nc">AbstractModule</span> <span class="o">{</span>
	<span class="nd">@Provides</span>
	<span class="nc">WorkerPool</span> <span class="nf">workerPool</span><span class="o">(</span><span class="nc">WorkerPools</span> <span class="n">workerPools</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">workerPools</span><span class="o">.</span><span class="na">createPool</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Provides</span>
	<span class="nd">@Worker</span>
	<span class="nc">String</span> <span class="nf">string</span><span class="o">(</span><span class="nd">@WorkerId</span> <span class="kt">int</span> <span class="n">workerId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Hello from worker #"</span> <span class="o">+</span> <span class="n">workerId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="nc">Injector</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">WorkerPoolModule</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">WorkerPoolModuleExample</span><span class="o">());</span>
		<span class="nc">WorkerPool</span> <span class="n">workerPool</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">WorkerPool</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="nc">WorkerPool</span><span class="o">.</span><span class="na">Instances</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">workerPool</span><span class="o">.</span><span class="na">getInstances</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">strings</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>The dependency graph of the example includes the created worker pool and looks as follows:</p>
<figure class="figure-image">
    <img src="/static/images/worker-pool-dependencies.png" style="max-width: 400px;" />
</figure>

<h3 id="multithreaded-worker-pools-collaboration"><strong>Multithreaded Worker Pools Collaboration</strong></h3>
<p>Several Worker Pools can co-work to calculate a single task. In this example we have 25 Workers and each of them has its 
own Eventloop. These Eventloops are wrapped in Threads and then added to the list of <em>threads</em>. After that the 
list is permuted and the threads with Eventloop tasks start. The task is to put Eventloop <em>id</em> in the <strong>ConcurrentLinkedQueue</strong> 
in accordance to the delay (the <em>id</em> multiplied by 100). In this way we receive an ordered queue of Eventloop ids, after that 
the Threads park and the queue is emptied.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MultithreadedWorkerCollab</span> <span class="kd">extends</span> <span class="nc">AbstractModule</span> <span class="o">{</span>

	<span class="nd">@Provides</span>
	<span class="nd">@Worker</span>
	<span class="nc">Eventloop</span> <span class="nf">eventloop</span><span class="o">(</span><span class="nd">@WorkerId</span> <span class="kt">int</span> <span class="n">wid</span><span class="o">,</span> <span class="nc">ConcurrentLinkedQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">=</span> <span class="nc">Eventloop</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
		<span class="n">eventloop</span><span class="o">.</span><span class="na">delay</span><span class="o">(</span><span class="mi">100L</span> <span class="o">*</span> <span class="n">wid</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">wid</span><span class="o">));</span>
		<span class="k">return</span> <span class="n">eventloop</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Provides</span>
	<span class="nc">WorkerPool</span> <span class="nf">workerPool</span><span class="o">(</span><span class="nc">WorkerPools</span> <span class="n">workerPools</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">workerPools</span><span class="o">.</span><span class="na">createPool</span><span class="o">(</span><span class="mi">25</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Provides</span>
	<span class="nc">ConcurrentLinkedQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">queue</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nc">ConcurrentLinkedQueue</span><span class="o">&lt;&gt;();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="nc">Injector</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">WorkerPoolModule</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">MultithreadedWorkerCollab</span><span class="o">());</span>
		<span class="nc">WorkerPool</span> <span class="n">workerPool</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">WorkerPool</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="nc">WorkerPool</span><span class="o">.</span><span class="na">Instances</span><span class="o">&lt;</span><span class="nc">Eventloop</span><span class="o">&gt;</span> <span class="n">eventloops</span> <span class="o">=</span> <span class="n">workerPool</span><span class="o">.</span><span class="na">getInstances</span><span class="o">(</span><span class="nc">Eventloop</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">Eventloop</span> <span class="n">eventloop</span> <span class="o">:</span> <span class="n">eventloops</span><span class="o">.</span><span class="na">getList</span><span class="o">())</span> <span class="o">{</span>
			<span class="nc">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">eventloop</span><span class="o">);</span>
			<span class="n">threads</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="nc">Collections</span><span class="o">.</span><span class="na">shuffle</span><span class="o">(</span><span class="n">threads</span><span class="o">);</span>
		<span class="n">threads</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nl">Thread:</span><span class="o">:</span><span class="n">start</span><span class="o">);</span>

		<span class="k">for</span> <span class="o">(</span><span class="nc">Thread</span> <span class="n">thread</span> <span class="o">:</span> <span class="n">threads</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">thread</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="o">}</span>

		<span class="nc">ConcurrentLinkedQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Key</span><span class="o">&lt;</span><span class="nc">ConcurrentLinkedQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;()</span> <span class="o">{});</span>

		<span class="k">while</span> <span class="o">(!</span><span class="n">queue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
		<span class="o">}</span>

	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>


    <div class="row docs-prevnext">
        
            <div class="col-sm-6">
                <a class="docs-prevnext__button pull-left" href="service-graph.html">Prev</a>
            </div>
        
        
            <div class="col-sm-6">
                <a class="docs-prevnext__button pull-right" href="config.html">Next</a>
            </div>
        
    </div>
</div>


                </div>
            </div>
        
        <div class="container justify-content-between footer">
            <div class="col-md-4 col-lg-5"> &copy; 2021 ActiveJ LLC. All Rights Reserved</div>
            <div class="col-md-4 col-lg-3">Contact us: contact@activej.io</div>
            <div class="col-md-8 col-lg-4 footer__menu">
                <a href="http://uikernel.io">UIKernel</a>
                <a href="https://adkernel.com">AdKernel</a>
                <a href="https://github.com/activej/activej">GitHub</a>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src="../static/js/leon.js"></script>
    <script src="../static/js/index.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous">
    </script>
</body>
</html>
