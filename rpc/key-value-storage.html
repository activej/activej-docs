<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ 5.4.1 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ 5.4.1 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">Key-Value Storage | ActiveJ 5.4.1</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/rpc/key-value-storage"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Key-Value Storage | ActiveJ 5.4.1"><meta data-react-helmet="true" name="description" content="A key-value storage with high performance RPC communication protocol"><meta data-react-helmet="true" property="og:description" content="A key-value storage with high performance RPC communication protocol"><meta data-react-helmet="true" name="keywords" content="java,java framework,tutorial,guide,rpc,client-server,web application,key-value storage"><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/rpc/key-value-storage"><link data-react-helmet="true" rel="alternate" href="https://activej.io/rpc/key-value-storage" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/rpc/key-value-storage" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/rpc/key-value-storage" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/rpc/key-value-storage" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/assets/js/runtime~main.1390124b.js" as="script">
<link rel="preload" href="/assets/js/main.71e34b38.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/overview">Docs</a><a class="navbar__item navbar__link" href="/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Async I/O</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Boot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Inject</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Serializer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Specializer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">RPC</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rpc">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rpc/basic-examples">Basic Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rpc/key-value-storage">Key-Value Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rpc/memcached-like-application">Memcached-like Application</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Key-Value Storage</h1></header><p>In this tutorial, we will look at a remote key-value storage that has 2 basic operations: <code>put</code> and <code>get</code>. When
writing distributed applications, the question often arises about which protocol to use for communication. There are two main
options:</p><ul><li>HTTP/REST</li><li>RPC</li></ul><p>Although HTTP is more popular and well specified, it has some overhead. When performance is an important aspect of an application,
you need to use something faster. ActiveJ RPC was developed for this purpose, based on
fast serializers and an optimized communication protocol, which significantly improves application performance.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="what-you-will-need">What you will need:<a aria-hidden="true" class="hash-link" href="#what-you-will-need" title="Direct link to heading">â€‹</a></h2><ul><li>IDE or terminal</li><li>JDK 1.8+</li><li>Maven 3.0+</li></ul><p>To proceed with this guide you have need to download and run a <a href="#working-example">working example</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="working-example">Working Example<a aria-hidden="true" class="hash-link" href="#working-example" title="Direct link to heading">â€‹</a></h2><p>First of all, <a href="https://github.com/activej/activej/tree/examples-5.4.1" target="_blank" rel="noopener noreferrer">clone ActiveJ project</a> locally:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone -b examples-5.4.1 https://github.com/activej/activej.git</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Then open the project in your IDE of choice. Before running the example, build the project (<strong>Ctrl + F9</strong> for IntelliJ IDEA).</p><p>If you want to skip source code explanation, you can go straight to <a href="#testing">testing</a> section.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="source-code">Source code<a aria-hidden="true" class="hash-link" href="#source-code" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="basic-app-functionality">Basic app functionality<a aria-hidden="true" class="hash-link" href="#basic-app-functionality" title="Direct link to heading">â€‹</a></h4><p>Since we need to implement two basic operations (<code>put</code> and <code>get</code>), let&#x27;s start with the message classes that are used to communicate between client and server, namely <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/PutRequest.java" target="_blank">PutRequest</a>, <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/PutResponse.java" target="_blank">PutResponse</a>, <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/GetRequest.java" target="_blank">GetRequest</a>, and <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/GetResponse.java" target="_blank">GetResponse</a>.
Instances of these classes are serialized using a lightning-fast serializer library <a href="/serializer">ActiveJ Serializer</a>. It requires some meta information about these classes, which is provided by the corresponding annotations. The basic rules are as follows:</p><ul><li>Use <a href="https://github.com/activej/activej/blob/v5.4.1/core-serializer/src/main/java/io/activej/serializer/annotations/Serialize.java" target="_blank">@Serialize</a> annotation on properties that need to be serialized.</li><li>Use <a href="https://github.com/activej/activej/blob/v5.4.1/core-serializer/src/main/java/io/activej/serializer/annotations/Deserialize.java" target="_blank">@Deserialize</a> annotation with a property name (which should be the same as the one in the getter) in constructor.</li><li>Use <a href="https://github.com/activej/activej/blob/v5.4.1/core-serializer/src/main/java/io/activej/serializer/annotations/SerializeNullable.java" target="_blank">@SerializeNullable</a> on properties that can have <code>null</code> values.</li></ul><p>Message classes look like these:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class PutRequest {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final String key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final String value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public PutRequest(@Deserialize(&quot;key&quot;) String key, @Deserialize(&quot;value&quot;) String value) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.key = key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.value = value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String getKey() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String getValue() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class PutResponse {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final String previousValue;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public PutResponse(@Deserialize(&quot;previousValue&quot;) String previousValue) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.previousValue = previousValue;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @SerializeNullable</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String getPreviousValue() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return previousValue;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String toString() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;{previousValue=&#x27;&quot; + previousValue + &#x27;\&#x27;&#x27; + &#x27;}&#x27;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class GetRequest {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final String key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public GetRequest(@Deserialize(&quot;key&quot;) String key) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.key = key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String getKey() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return key;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class GetResponse {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final String value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public GetResponse(@Deserialize(&quot;value&quot;) String value) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.value = value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Serialize</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @SerializeNullable</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String getValue() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return value;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String toString() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;{value=&#x27;&quot; + value + &#x27;\&#x27;&#x27; + &#x27;}&#x27;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Next, let&#x27;s look at a simple implementation of a key-value storage, the <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/KeyValueStore.java" target="_blank">KeyValueStore</a></p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class KeyValueStore {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private final Map&lt;String, String&gt; store = new HashMap&lt;&gt;();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String put(String key, String value) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return store.put(key, value);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public String get(String key) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return store.get(key);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>A key-value store is very minimalistic. It uses a regular Java&#x27;s <code>Map</code> to store keys with corresponding values.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="client-and-server">Client and server<a aria-hidden="true" class="hash-link" href="#client-and-server" title="Direct link to heading">â€‹</a></h4><p>Now let&#x27;s look at the <a href="https://github.com/activej/activej/blob/v5.4.1/core-inject/src/main/java/io/activej/inject/module/AbstractModule.java" target="_blank">AbstractModule</a> for the RPC server, which uses the <a href="/inject">ActiveJ Inject</a> dependency injection library to handle <code>get</code> and <code>put</code> requests.</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ServerModule extends AbstractModule {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final int RPC_SERVER_PORT = 5353;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Eventloop eventloop() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return Eventloop.create()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withEventloopFatalErrorHandler(rethrow());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  KeyValueStore keyValueStore() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return new KeyValueStore();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  RpcServer rpcServer(Eventloop eventloop, KeyValueStore store) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return RpcServer.create(eventloop)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withSerializerBuilder(SerializerBuilder.create())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withMessageTypes(PutRequest.class, PutResponse.class, GetRequest.class, GetResponse.class)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withHandler(PutRequest.class, req -&gt; Promise.of(new PutResponse(store.put(req.getKey(), req.getValue()))))</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withHandler(GetRequest.class, req -&gt; Promise.of(new GetResponse(store.get(req.getKey()))))</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withListenPort(RPC_SERVER_PORT);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>As you can see, to properly define the <a href="https://github.com/activej/activej/blob/v5.4.1/cloud-rpc/src/main/java/io/activej/rpc/server/RpcServer.java" target="_blank">RpcServer</a>, we specified all the message classes that are sent between client and server, and specified the corresponding <a href="https://github.com/activej/activej/blob/v5.4.1/cloud-rpc/src/main/java/io/activej/rpc/server/RpcRequestHandler.java" target="_blank">RpcRequestHandler</a> for each request class.</p><p>We have specified them as the second arguments in these lines, using lambdas.</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">.withHandler(PutRequest.class, req -&gt; Promise.of(new PutResponse(store.put(req.getKey(), req.getValue()))))</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.withHandler(GetRequest.class, req -&gt; Promise.of(new GetResponse(store.get(req.getKey()))))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Next, let&#x27;s look at the <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/ServerLauncher.java" target="_blank"><code>ServerLauncher</code></a> for the RPC server. The <a href="/boot/launcher">ActiveJ Launcher</a> is used here to manage the lifecycle of the application:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ServerLauncher extends Launcher {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Inject</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private RpcServer server;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  protected Module getModule() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return combine(</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ServiceGraphModule.create(),</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new ServerModule());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  protected void run() throws Exception {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    awaitShutdown();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public static void main(String[] args) throws Exception {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ServerLauncher launcher = new ServerLauncher();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    launcher.launch(args);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Since we extended <strong>Launcher</strong> class, we also had to override 2 methods: <em>getModule()</em> to provide <a href="/boot/servicegraph">ServiceGraphModule</a> and <em>run()</em> to describe the main logic of the example.</p><p>Now let&#x27;s look at the RPC client. We have once again specified all the message classes that are used for communication, and we have specified the <a href="/rpc/basic-examples#round-robin-strategy">RPC strategy</a>. All strategies can be combined, but since we have only one server, we use a <a href="https://github.com/activej/activej/blob/v5.4.1/cloud-rpc/src/main/java/io/activej/rpc/client/sender/RpcStrategySingleServer.java" target="_blank">single-server</a> strategy:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ClientModule extends AbstractModule {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final int RPC_SERVER_PORT = 5353;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Eventloop eventloop() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return Eventloop.create()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withEventloopFatalErrorHandler(rethrow())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withCurrentThread();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  RpcClient rpcClient(Eventloop eventloop) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return RpcClient.create(eventloop)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withConnectTimeout(Duration.ofSeconds(1))</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withSerializerBuilder(SerializerBuilder.create())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withMessageTypes(PutRequest.class, PutResponse.class, GetRequest.class, GetResponse.class)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withStrategy(RpcStrategies.server(new InetSocketAddress(&quot;localhost&quot;, RPC_SERVER_PORT)));</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Let&#x27;s also take a look at the <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/tutorials/rpc-kv-storage/src/main/java/ClientLauncher.java" target="_blank">ClientLauncher</a>. In the <code>run()</code> method, we are parsing command line arguments and make appropriate requests to the <strong>RpcServer</strong></p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ClientLauncher extends Launcher {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final int TIMEOUT = 1000;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Inject</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private RpcClient client;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Inject</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Eventloop eventloop;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  protected Module getModule() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return combine(</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ServiceGraphModule.create(),</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new ClientModule());</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  protected void run() throws Exception {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (args.length &lt; 2) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      System.err.println(&quot;Command line args:\n\t--put key value\n\t--get key&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      return;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    switch (args[0]) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      case &quot;--put&quot;:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CompletableFuture&lt;PutResponse&gt; future1 = eventloop.submit(() -&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            client.sendRequest(new PutRequest(args[1], args[2]), TIMEOUT)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        );</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PutResponse putResponse = future1.get();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        System.out.println(&quot;PutResponse: &quot; + putResponse);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      case &quot;--get&quot;:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CompletableFuture&lt;GetResponse&gt; future2 = eventloop.submit(() -&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            client.sendRequest(new GetRequest(args[1]), TIMEOUT)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        );</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        GetResponse getResponse = future2.get();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        System.out.println(&quot;GetResponse: &quot; + getResponse);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      default:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        throw new RuntimeException(&quot;Unsupported option: &quot; + args[0]);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public static void main(String[] args) throws Exception {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ClientLauncher launcher = new ClientLauncher();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    launcher.launch(args);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Congratulations! We have finished exploring the code of this application.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="testing">Testing<a aria-hidden="true" class="hash-link" href="#testing" title="Direct link to heading">â€‹</a></h3><p>First, launch the server. Open the <code>ServerLauncher</code> class and run its <code>main()</code> method.</p><p>Then make a <code>PUT</code> request. Open <code>ClientLauncher</code> class which is located at <code>activej/examples/tutorials/rpc-kv-storage</code>,
and set the program arguments to <code>--put key1 value1</code>. For IntelliJ IDEA: <code>Run -&gt; Edit configurations -&gt;
|Run/Debug Configurations -&gt; |Program arguments -&gt; --put key1 value1||</code>. Then run the <code>main()</code> method of a launcher.</p><p>You will see the following output:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">PutResponse: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">previousValue</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;null&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Finally, make a <code>GET</code> request.</p><p>Open the <code>ClientLauncher</code> class once again and set the program arguments to <code>--get key1</code>. For IntelliJ IDEA: <code>Run -&gt;
Edit configurations -&gt; |Run/Debug Configurations -&gt; |Program arguments -&gt; --get key1||</code>. Then run the <code>main()</code> method of a launcher.</p><p>You will see the following output:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><pre tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">GetResponse: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">value</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Congratulations, you have just launched a remote key-value storage based on the RPC communication protocol!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rpc/basic-examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Basic Examples</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rpc/memcached-like-application"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Memcached-like Application<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-you-will-need" class="table-of-contents__link toc-highlight">What you will need:</a></li><li><a href="#working-example" class="table-of-contents__link toc-highlight">Working Example</a><ul><li><a href="#source-code" class="table-of-contents__link toc-highlight">Source code</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1390124b.js"></script>
<script src="/assets/js/main.71e34b38.js"></script>
</body>
</html>