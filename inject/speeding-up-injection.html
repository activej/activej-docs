<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ 5.4.1 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ 5.4.1 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">Speeding up dependency injection | ActiveJ 5.4.1</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/inject/speeding-up-injection"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Speeding up dependency injection | ActiveJ 5.4.1"><meta data-react-helmet="true" name="description" content="ActiveJ Specializer optimization"><meta data-react-helmet="true" property="og:description" content="ActiveJ Specializer optimization"><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/inject/speeding-up-injection"><link data-react-helmet="true" rel="alternate" href="https://activej.io/inject/speeding-up-injection" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/inject/speeding-up-injection" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/inject/speeding-up-injection" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/inject/speeding-up-injection" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ebdfb6ec.css">
<link rel="preload" href="/assets/js/runtime~main.1390124b.js" as="script">
<link rel="preload" href="/assets/js/main.71e34b38.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/overview">Docs</a><a class="navbar__item navbar__link" href="/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Async I/O</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Boot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Inject</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/basics">Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/injecting-instances">Injecting instances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/class-scanning">Class scanning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/duplicate-bindings">Duplicate bindings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/binding-generation">Generating bindings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/binding-transformation">Transforming bindings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/optional-dependencies">Optional dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/scopes">Scopes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/transient-bindings">Transient bindings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/inject/speeding-up-injection">Speeding up dependency injection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/under-the-hood">Under the hood</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/cookbook-example">Cookbook example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/inject/benchmarks">Benchmarks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Serializer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Specializer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Speeding up dependency injection</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="activej-specializer-optimization">ActiveJ Specializer optimization<a aria-hidden="true" class="hash-link" href="#activej-specializer-optimization" title="Direct link to heading">â€‹</a></h2><p><a href="/specializer"><strong>ActiveJ Specializer</strong></a> is a library that optimizes code for the JVM. You can simply combine
it with ActiveJ Inject and speed up your code by <a href="https://github.com/activej/activej/blob/v5.4.1/benchmarks/inject/src/main/java/io/activej/inject/ActiveJDirectScopebindBenchmark.java" target="_blank">up to 30%</a>
To set up ActiveJ Specializer, simply use <code>Injector.useSpecializer()</code> before instantiating the <strong>Injector</strong>.
ActiveJ Inject compiles bindings at runtime into a highly efficient representation. When combined with ActiveJ Specializer,
bindings can be turned into bytecode, which will be just as efficient as manually written code. This way, you get
maximum performance in real-life projects without having to maintain complex manual code.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="how-it-works">How it works<a aria-hidden="true" class="hash-link" href="#how-it-works" title="Direct link to heading">â€‹</a></h2><p>To understand how ActiveJ Specializer works, you can read the <a href="/specializer">specializer documentation</a>.
Here we will use a simple example to try to explain how the specializer works in relation to ActiveJ Inject.</p><p>The specializer transforms class instances into a special classes in which instance methods are replaced with static methods
and instance fields are replaced with static fields. Instances that are specialized are actually instances of a <a href="https://github.com/activej/activej/blob/v5.4.1/core-inject/src/main/java/io/activej/inject/impl/CompiledBinding" target="_blank">CompiledBinding</a> class.</p><p>Suppose we have a module that defines the following binding:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">@Provides</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Integer length(String string) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return string.length();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>The compiled bindings here may look like this (a simplified version):</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class CompiledBindingImpl&lt;R, U&gt; implements CompiledBinding&lt;R&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private final CompiledBinding&lt;U&gt; otherBinding;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private R instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public CompiledBindingImpl(CompiledBinding&lt;U&gt; otherBinding) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        this.otherBinding = otherBinding;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public R getInstance() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (instance != null) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } else {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            U otherInstance = otherBinding.getInstance();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            this.instance = createInstance(otherInstance);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return this.instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected R createInstance(U otherInstance) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>If we use <code>Injector.useSpecializer()</code> before creating the injector, we get a specialized compiled binding (a simplified version):</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class CompiledBindingInteger implements CompiledBinding&lt;Integer&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private static Integer instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public Integer getInstance() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return getInstanceSpecialized();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public static Integer getInstanceSpecialized() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (instance != null) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } else {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            String stringInstance = CompiledBindingString.getInstanceSpecialized();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            this.instance = createInstance(stringInstance);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return this.instance;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public static Integer createInstance(String otherInstance) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Because the specializer replaced instance methods with static methods and instance fields with static fields, this allows for
additional JVM optimizations and also neglects the overhead of dynamic dispatching. Also, this may seem like minimal
optimization, but imagine if you have a huge dependency graph and need to create instances at runtime. For example, when
using ActiveJ Inject to handle HTTP requests, when you need to instantiate new objects at every HTTP request. In this
scenario, the performance boost of using the specializer would be significant.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="speeding-up-rpc-request-processing">Speeding up RPC request processing<a aria-hidden="true" class="hash-link" href="#speeding-up-rpc-request-processing" title="Direct link to heading">â€‹</a></h2><p>We created an <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/cloud/rpc/src/main/java/specializer/ScopedRpcServerExample.java" target="_blank">example</a> of
using ActiveJ Inject + ActiveJ Specializer to improve the performance of an RPC server that uses dependency injection to process RPC
requests. To learn more about ActiveJ RPC you can visit <a href="/rpc">this page</a>.</p><p>The dependency graph on the server is similar to the one show in the <a href="/inject/cookbook-example">Cookbook example</a>. Each incoming RPC
request is handled within the RPC <a href="/inject/scopes">scope</a>.</p><p>The example also comes with a dedicated <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/cloud/rpc/src/main/java/specializer/ScopedRpcBenchmarkClient.java" target="_blank">benchmark tool</a> that
you can run to measure server performance.</p><p>Try running the server and the benchmark tool as-is and measure the performance. Then comment out the <code>Injector.useSpecializer()</code> line
in <a href="https://github.com/activej/activej/blob/examples-5.4.1/examples/cloud/rpc/src/main/java/specializer/ScopedRpcServerExample.java" target="_blank">ScopedRpcServerExample</a> and run
the server and the benchmark tool again. You should see significant performance gains over not using ActiveJ Specializer.
We have measured server performance gains of up to 2x.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/inject/transient-bindings"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Transient bindings</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/inject/under-the-hood"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Under the hood<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#activej-specializer-optimization" class="table-of-contents__link toc-highlight">ActiveJ Specializer optimization</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#speeding-up-rpc-request-processing" class="table-of-contents__link toc-highlight">Speeding up RPC request processing</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1390124b.js"></script>
<script src="/assets/js/main.71e34b38.js"></script>
</body>
</html>