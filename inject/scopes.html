<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ActiveJ 5.0 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ActiveJ 5.0 Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176574648-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-176574648-1",{})</script><title data-react-helmet="true">Scopes | ActiveJ 5.0</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://activej.io/img/preview.png"><meta data-react-helmet="true" property="og:url" content="https://activej.io/inject/scopes"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Scopes | ActiveJ 5.0"><meta data-react-helmet="true" name="description" content="A Scope in ActiveJ Inject allows you to reuse instances. A scoped instances are independent of instances in other scopes."><meta data-react-helmet="true" property="og:description" content="A Scope in ActiveJ Inject allows you to reuse instances. A scoped instances are independent of instances in other scopes."><link data-react-helmet="true" rel="shortcut icon" href="/./img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://activej.io/inject/scopes"><link data-react-helmet="true" rel="alternate" href="https://activej.io/inject/scopes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://activej.io/zh/inject/scopes" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://activej.io/ru/inject/scopes" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://activej.io/inject/scopes" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cd595f84.css">
<link rel="preload" href="/assets/js/runtime~main.53da3784.js" as="script">
<link rel="preload" href="/assets/js/main.6a9e5bf8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/./img/logo.webp" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ActiveJ</b></a><a class="navbar__item navbar__link navbar__link--active" href="/overview">Docs</a><a class="navbar__item navbar__link" href="/tutorials/getting-started">Tutorials</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/inject/scopes" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/inject/scopes" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">中文 (machine translation)</a></li><li><a href="/ru/inject/scopes" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Русский (machine translation)</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/activej/activej" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/overview">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Async I/O</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Boot</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Inject</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/basics">Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/injecting-instances">Injecting instances</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/class-scanning">Class scanning</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/duplicate-bindings">Duplicate bindings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/binding-generation">Generating bindings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/binding-transformation">Transforming bindings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/optional-dependencies">Optional dependencies</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/inject/scopes">Scopes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/transient-bindings">Transient bindings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/speeding-up-injection">Speeding up dependency injection</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/under-the-hood">Under the hood</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/cookbook-example">Cookbook example</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/inject/benchmarks">Benchmarks</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Serializer</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Specializer</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RPC</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FS</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scopes</h1></header><p>A Scope in ActiveJ Inject allows you to reuse instances. A scoped instances are independent of instances in other scopes.
By default, each instance obtained from an <code>Injector</code> is singleton. That means it is cached and when you try to retrieve
an instance of the same type once again, a cached instance is returned. But, there are situations when you need to recreate
some instances as they are tied to some semantic scope (application scope, request scope, process scope).</p><p>For example, we can have a dedicated HTTP scope. Each request will be bound to the HTTP scope and every instance created
within this scope is valid only during a lifetime of an HTTP request (time between receiving an HTTP request and returning
an HTTP response).</p><p>An <code>Injector</code> may &quot;enter&quot; the scope. That means a new scoped <code>Injector</code> will be created out of the main one.
This &quot;scoped&quot; injector will have a link to the parent injector, so in case it cannot obtain some instance from within its
own scope it will fall back to the parent injector.</p><p>Scopes can be nested. You can have a scope inside another scope and so on. When you try to get an instance from a nested
scope injector, what happens is the innermost injector gets queried first. If it cannot return an instance, the next upper scope
injector will be queried and so on until we can return an instance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="defining-scopes"></a>Defining scopes<a class="hash-link" href="#defining-scopes" title="Direct link to heading">#</a></h2><p>A scope is represented using a special scope annotation. A scope annotation is a marker annotation
(meaning it has no members or data) that is itself annotated with a special marker annotation <a href="https://github.com/activej/activej/blob/v5.0/core-inject/src/main/java/io/activej/inject/ScopeAnnotation" target="_blank">@ScopeAnnotation</a>.</p><p>Here is how we can have define an annotation for HTTP scope:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@ScopeAnnotation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Target(ElementType.METHOD)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RUNTIME)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface HttpScope {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>We can then define a binding within the HTTP scope using <a href="https://github.com/activej/activej/blob/v5.0/core-inject/src/main/java/io/activej/inject/module/ModuleBuilder" target="_blank">ModuleBuilder</a> DSL:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">bind(Integer.class).toInstance(123).in(HttpScope.class)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Another way to define a scoped binding is to use scope annotation with <code>@Provides</code> annotated methods like this:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">@Provides</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@HttpScope</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Integer integer() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 123;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>We have annotated scope annotation with <code>@Retention(RUNTIME)</code> annotation as scopes are processed at the runtime.</p><p><code>@Target(ElementType.METHOD)</code> annotation is present because we use scope annotations on methods.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="entering-a-scope"></a>Entering a scope<a class="hash-link" href="#entering-a-scope" title="Direct link to heading">#</a></h2><p>To enter a certain scope we use <code>Injector#enterScope(Scope)</code> method that returns a &quot;scoped&quot; injector.</p><p>For example, let&#x27;s enter the HTTP scope defined previously:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W java"><pre tabindex="0" class="prism-code language-java codeBlock_6upA thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#393A34"><span class="token plain">Injector scopedInjector = injector.enterScope(Scope.of(HttpScope.class));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn">Copy</button></div></div><p>Now we can use <code>scopedInjector</code> to retrieve instances from within HTTP scope.</p><p>You can find a full example of HTTP scope on <a href="https://github.com/activej/activej/blob/examples-5.0/examples/core/inject/src/main/java/ScopeExample.java" target="_blank">Github</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/inject/optional-dependencies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Optional dependencies</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/inject/transient-bindings"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transient bindings »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defining-scopes" class="table-of-contents__link">Defining scopes</a></li><li><a href="#entering-a-scope" class="table-of-contents__link">Entering a scope</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 ActiveJ LLC. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.53da3784.js"></script>
<script src="/assets/js/main.6a9e5bf8.js"></script>
</body>
</html>